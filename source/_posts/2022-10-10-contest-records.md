---
title: 比赛记录
subtitle: 挂分记录
layout: post
show: true
top: 0
tags: 
- 杂项
- 日志
- 咕咕
password: boomedzero
cover: /img/2022-11-23-20-19-22-image.png

---

# 比赛记录

## ZSContest

很久以前写下zscontest的编号. . . zs是什么啊?

是不是振声啊

### A [博弈论] [打表]

> $n\times m$ 的网格上有若干硬币, 初始时全部为反, $q$ 次翻转一个矩形并询问, 若两人轮流操作, 每次先选择一枚正面硬币 $(x, y)$ , 再选择一个 $(a, y), a<x$ 或 $(x, b), b<y$ , 同时翻转这两个格子的硬币, 不能操作的人输, 是先手必胜还是后手必胜.
> 
> $n, m\le 10^9, q\le 10^5$ 

首先结论: 每一枚硬币是独立的. 这个操作实际上相当于硬币可以向左或向下移动若干步, 两枚硬币碰到一起就一起消失, 那么考虑假设硬币不会消失的情况和这个是等价的, 因为若选择移动多枚硬币位置相同, 后手仍然以相同方式移动这个位置到先手移动到的位置是不会让局面更优也不会更劣等, 所以是等价的.

于是每一枚硬币分别的SG值求出来异或, 打表SG值和其矩形前缀和找规律吧.

### B [复杂度]

> 有 $n$ 个数对 $(a, b)$ 构成的集合, 给定 $m$ , $k$ 和集合, 求最小的 $t$ 满足有至少 $k$ 个不同子集的 $\sum a+bt\ge m$ .
> 
> $n, k\le 10^5, a, b, m\le 10^9$ 

二分答案是容易想到的, 于是变成了求有多少个子集和大于 $m$ 或子集和的第 $k$ 大.

一般rank总是比kth容易, 发现k并不到 $2^n-1$ , 我们的复杂度一定是相关 $k$ 的, 然后就不会了.

一个我没见过的经典题求所有子集合的第 $k$ 大, 解法是爆搜子集, 当前结果大于等于 $m$ 就返回, 否则把个数加一继续搜.

这个复杂度的分析是重点, qyc一开始说因为每次递归让方案数变大1, 最多到 $k$ (不然直接停), 于是就解决了, 但实际上, 若初始状态为全部不选, 连续若干个不选并不会增加方案数, 正确的做法是先递增排序, 这样如果前面的不选后面的更选不了可以直接跳, 就仍然有每次递归方案数变大1了.

然而这个题还有负数, 考虑我们搜大于等于 $m$ 的子集, 就要满足:

- 一旦和低于 $m$ 就能退出

- 若这个不选以后的也不能选

所以初始状态为选所有正数不选所有负数, 并按绝对值排序, 这样做保证如果当前这一位相比初始状态不能改变以后的也不行可以直接跳.

### C [直径]

> 单点修改边权, 查子树直径. $n\le 10^5$ .

合并直径是简单的, 四个端点两两比一比就好了, 因为要查距离并支持修改所以用BIT维护点到根距离, 并用建在欧拉序上的线段树维护直径解决问题.

另一种做法是静态toptree说能1log, 但我还不会静态toptree, 需要学习一下.

### D [FFT] [多项式]

> 给一个 $V\le 2$ 个点, 识别括号和空格的自动机, 字符集为 $(, ), space$ , 求有多少种从点 $s$ 到点 $t$ 走 $n$ 的方案行成合法括号串. 
> 
> $n\le 10^5$ 

万恶多项式, 打完 $n\le 1000$ 走人.

等学了分治FFT再来.


## 22. 10. 10 VP CF1198 Codeforces Round #576 (Div. 1)

和wjw, 难度感觉不大到Div1.

过程大概是先切A, 然后看一眼B直接SegmentTreeBeats没冲出来发现自己不会STB///fn. 然后去开C, D, E, F, 发现E好像可做. 仔细一想是个套路网络流把它冲出来了, 然后去做B写了个更简单的O(n)做法. 比赛结束.

wjw切了 $B\to A\to D$

### A MP3

智障题.

### B. Welfare State

> 单点改, 区间取max. $n, q\le 2\times 10^5$

写吉老师线段树的都降智.

直接离线, 对每个点考虑, 一个点的值是它最后一次修改的值和从这一次修改开始往后这一段时间取max的最大值. 复杂度线性.

所以CF这种短时间比赛反而更不能急着码, 多想想是不是可以写的简单点.

### C. Matching vs Independent Set

> 给一个 $3n$ 个点, $m$ 条边的图, 你给出一个 $n$ 个点的独立集或一个 $n$ 个边的匹配.
> 
> $n\le 10^5, m\le 5\times 10^5$ . 多组询问.

qyc的做法, 任意求一棵dfs树, 如果叶子多于 $n$ 个就选叶子, 否则现在叶子少于 $n$ 个, 除了叶子每个点都可以和自己的父亲/儿子匹配, 于是至少有 $n$ 个边. 就结束了.

wjw看了看slime的做法, 说的是直接贪心求匹配(任意加边), 如果够 $n$ 条直接结束, 否则因为只使用了少于 $2n$ 个点, 且剩下的点已经选不出相邻的两个点形成匹配, 所以剩下的一起当独立集即可.

### D. Rectangle Painting 1

> 给一个 $n\times n$ 的网格图, 一开始格子有黑有白, 每次你可以花费 $\max w, h$ 的代价将一个 $w\times h$ 的矩形染白, 求全白的最小代价.
> $n\le 50$

降智题

做法是, 要么一个操作染了全局, 否则必然有一个未染色的分界点(分界成左上和右下), 然后可以递归下去做. 这样复杂度 $n^5$ .

还是不太敢想这种 $n^5$ 复杂度的东西啊///kk, 明明是可以很简单的.

### E. Rectangle Painting2

> 给一个 $n\times n$ 的网格图, 一开始格子有黑有白, 每次可以花费 $\min w, h$ 的代价将一个 $w\times h$ 的矩形染白, 求全白的最小代价.
> 
> 黑色格子的给出方式是输入 $m$ 个矩形, 黑色格子为这 $m$ 个矩形的并.
> 
> $n\le 10^9, m\le 50$ .

套路题. 首先我们显然会每次将染一行或一列全染白, 于是就成了选若干行和列覆盖所有位置. 这个模型有点像网络流, 然后发现一个最小割结束战斗(行点列点, 行向列连 $inf$ , 起点, 终点向行列连1). 然后突然发现黑色格子是由矩形给出的. 不过没关系, 直接离散化, $m$ 个矩形在平面上切割刀连通块数是 $m^2$ 的, 所以就是 $4m$ 个点, $m^2+2m$ 个边冲就好了.

### F. GCD Groups 2

> 给出 $n$ 个整数, 要将它们划分成两个集合使得这两个集合各自 $\gcd$ 为1, 求方案或判断无解.
> 
> $n\le 10^5$

有点意思.

智慧法: 从前往后扫, 考虑第一个集合, 如果当前这个数不是 $\gcd$ 的倍数就加入这个一集合, 这样 $gcd$ 一定变小. 然后一遍肯定不对就randomshuffle. 正确的原因是, $10^9$ 的不同质因数个数只有9, $10^9$ 到质数大约有 $5\times 10^7$ 个很多, 所以很难出现一种状况让一整个集合有一个共同质因子.

官方正解(搬运翻译):

首先, 你只要用 $9$ 个数干掉每一个因子. 所以有解情况下必然由一种情况使得在其中一个集合大小不超过9.

然后随机取两个数钦定它们在不同的集合中, 这样同一个集合的概率很小(因为其中一个集合只有9个数). 然后对一个集合做状压dp(压掉当前还活着哪些质因子). 这样做复杂度是 $n\times 2^{2k}$ .

最后实际不需要全部 $n$ 个数做这个dp, 可以对每个素数取 $2k$ 个, 这个数量可以杀掉其他所有素数, 无论如何会有一个空余的可用. 复杂度 $k^2\times 2^{2k}$ .

官方正解真阴, 随机化万岁! .

## 22. 10. 12 VP CF1736 Codeforces Round #825 (Div. 2)

又是降智的一天呢!

### A. Make A Equal to B

智障题

### B. Playing with GCD

没切Div2B, 输麻从此刻开始///fn///fn///fn

> 给定序列 $a_n$ , 判断是否有可能构造序列 $b_{n+1}$ 满足 $a_i=\gcd(b_i, b_{i+1})$ .
> 
> $\sum n\le 10^5$

把每一个数看作向量, $\gcd$ 是对向量每个元素取 $\min$ , 考虑如果你的向量 $b_i$ 的一个元素同时比 $a_i$ 和 $a_{i-1}$ 的对应元素大, 那么一定是不优的(你不能用它做取 $\min$ 了). 所以结论是 $b_i=\operatorname{a_i, a_{i-1}}$ , 然后有可能不行, 所以再 check 一遍.

### C1. Good Subarrays (Easy Version)

写麻烦做法, 继续寄///ll

> 给定序列 $a_n$ , 求有多少子区间 $[l, r]$ 满足 $\forall i\in [l, r], \ a_i\ge {i-l+1}$
> 
> $\sum n\le 2\times 10^5$ , 多组询问

赛时写了个, 从后面往前扫, 每次给当前后缀区间减1, 二分第一个小于 $0$ 的位置. 总结应该是, 还是太着急写代码, 明明想到某些单调性但觉得这个不难写就直接冲了.

考虑每个位置减去下标, 问题变成 $\forall i\in [l, r]\ , a_i\ge -l+1$ .

然后考虑每个左端点, 合法的右端点是一个前缀, 并且每个左端点对应的合法右端点是单增的, 那么可以直接从上一个左端点的右端点开始往后扫就能处理出每个位置为左端点对应的右端点, 把这个数组记为 $r$ .

不过看起来不给前后缀区间减一没有关系, 重点是要发现右端点单增可以直接扫///fn

### C2. Good Subarrays (Hard Version)

接着刚才的做法, 区别是加了独立的单点询问.

发现改小是直接二维数点(平面上线段, 求矩形内线的总长), 改大比较问号, 我们根本不会追溯修改.

然后我在错误的道路上越走越远了.

然后汪娟突然跳出来: 改大不是比改小简单吗?

是的! 我们是智障! ///fn, 因为改大的时候, 你只会改一个数, 所以对一个 $i$ , 可以处理若 $r_i+1$ 被改对了那么新的 $r_i$ 是几, 就做完了.

CF官方题解上改大和改小是同一个处理///jy厉害了

## Public NOIP Round #3 (Div. 1, 提高)

### A. 移除石子

> 给定平面上 $n$ 个点, 构造选择 $\dfrac{n}{2}$ 个正方形的方案使得每个正方形内恰好有两个点, 且正方形覆盖了所有点.
> 
> $T\le 60, n\le 3000, x_i, y_i\le 10^9$

每个点对建一个点, 然后从构成点对的两个点指向代表点对的点, 遍历每个点对, 如果这个点对 $u$ 组成的矩形上或内有另一个点 $v$ 则连边 $u\to v$ , 然后在图上跑拓扑排序.

不对, 边数 $n^3$ , 一个矩形内可能有一摞点.

考虑从左往右扫, 如果当前左边的点没法消, 就把它插入到操作序列的最后, 否则放在操作序列的最前面, 就可以了.

提高不会A是怎么回事啊///ll

然后qyc说, 汪娟看了这场说只会D, 于是看D


### D. 数圈圈

> 给定一个 $n\times m$ 网格, 每个位置是一个小写字母, 求有多少个矩形满足边框上字母相同.
> 
> $n, m\le 2000$

直接对每个位置预处理向右向下向左向上最远到哪里, 那么枚举一个左上角, 就要求一个矩形内所有向左向上超过左上角坐标位置的, 就直接数点了. 要对每个颜色分开做即可.

诶不对, 这是2log的, 死了.

考虑竖着分治, 画一条横线, 考虑穿过它的矩形, 那么现在我们可以用 $n^2$ 的时间去干一层.

我们预处理每个位置向上向下延伸多远, 然后确定左边的一条竖线, 向右扫描, 维护当前有多少个向右的横线, 在每个竖线统计答案.

对于维护横线这一步, 我们先预处理出所有向右的横线, 然后在一个位置加入贡献, 在另一个位置删除贡献即可.

A, C todo

## CSP-S 2022

遗憾疫情把csp杀了///fn

### T1 假期计划(holiday)

> 给定 $Graph(n, m)$ , 点有点权 $w_i$ , 求 $a, b, c, d$ 满足 $1\to a\to b\to c\to d\to 1$ 这条路径中两两点距离不超过 $k$ , 且最大化 $w_a+w_b+w_c+w_d$ .
> 
> $n\le 2500, m\le 10000, k\le 100$

先 $nm$ 求一遍距离应该没什么异议.

考虑 $n^2$ , 而且只出 $a, b, c, d$ 肯定是让你枚举的, 一般这种都是中间的比较重要, 考虑枚举 $b, c$ , 于是现在要确定 $a, c$ , 直接对每个点 $u$ 处理 $1\to u$ 路途中点权的最大的, 次大的, 发现还是可能重复, 那就再处理次次大的, 发现肯定行了.

问号 $k\le 100$ 是干什么的?

### T2 策略游戏(game)

> 给定 $a_n, b_m$ , $q$ 次询问, 每次给定参数 $l_1, r_1, l_2, r_2$ , 求A先从 $a_{ [l_1, r_1] }$ 中选一个数, B再从 $b_{ [l_2, r_2] }$ 中选一个数, A想最大化两数乘积, B想最小化, 求最后乘积是多少.
> 
> $n, m, q\le 10^5$

那就是最小值的最大值, 分正负数讨论, 然后用随便什么RMQ做就了.

### T3 星战(galaxy)

> 给定有向图 $Graph(n, m)$ , $q$ 次操作, 每次删去一个边, 或恢复一条之前被删掉的边, 或删掉连向一个点的所有**入**边, 或恢复一个点的所有入边, 或者问当前的图是不是所有点出度为 $1$ .
> 
> $n, m, q\le 5\times 10^5$

光想着对度数搞根号分治了///fn

考虑hash边集, 维护全局hash值, 那么处理每个点周围的hash, 操作点直接做, 操作边要改全局hash和连向的点的hash即可.

为什么脑子里总是没有随机化这根弦啊?

### T4 数据传输 (transmit)

> 给定 $Tree(n)$ , 点有点权 $w_i$ , $q$ 次询问对于点 $u, v$ , 选定序列 $c$ , 使得序列相邻两项距离不超过 $k$ , 序列首/末项到 $u$ / $v$ 的距离不超过 $k$ , 序列中点的权值和的最小值.
> 
> $n, q\le 2\times 10^5, k\le 3$

$k\le 3$ ! ! !

直接DDP $f_{u, 0/1/2}$ 表示上一个点距离自己 $0/1/2$ 的情况的最小权值, 这里正反是一样的, 所以从 $u, v$ 分别矩阵乘到lca, 然后在lca处合并.

但是当 $k=3$ 的时候, 有可能选择一个不在 $u, v$ 路径上的点, 但发现那样的话必然是路径上的点的儿子, 所以动态dp的时候搞一下权值就行了.

UPD: 写了代码, 这个题不难写, 注意一下那个不在路径上的点要算上父亲.

### 总结

今年CSP怎么感觉是数据结构复兴啊///yw 是因为去年dp麻了吗///yw

T1中规中矩, 可能和廊桥分配差不多?

T2相比去年简单, 相比2020稍难

T3脑子里没有hash这根弦, 大家真的好会随机化///ll

T4的ddp可能有点板?

暴力分挺足, T3想不出hash边集也有300+, 感觉得分上比去年容易多了.

## ZSContest 20221105

### C0A 分开了哦算

> 给定括号序列 $s_n$ 和括号的颜色 $c_n\in \{0, 1, 2\}$ , 每次可一1代价翻转一个括号, 颜色不能改变, 求最小代价使得 $c_i\in \{0, 2\}$ 和 $c_i\in \{1, 2\}$ 的括号分别组成合法括号串.
> 
> $n\le 5000$

考虑一个经典结论, 在插入/修改一个括号序列使其合法的时候, 只把一个前缀的右括号改成左括号, 一个后缀的右括号改成左括号是不劣的. 证明可以考虑括号序列把`(`看作 $+1$ , `)`看作 $-1$ 的一个折现, 每次修改一个括号是给一个后缀加/减2, 最后要所有位置都不低于0且最后位置等于0, 那就显然了.

于是一个 $n^3$ 做法是枚举 $c_i=2$ 的括号被修改的前后缀, 在确定了它之后确定另外两个就是简单的了(就是给定一个括号串, 其中若干位置不能改, 要求改成一个合法的, 只要从前往后扫, 每次如果前缀和小于0就把一个最靠前的左括号改成右括号, 最后不断把最靠右的右括号改成左括号, 可以开俩堆).

考虑不枚举前后缀, 转而枚举 $c_i=0$ 的括号的和, 这样一来另外两种括号的和同样是确定的, 那么先通过操作最左, 最右的括号把它的和调整对, 在这个基础上, 求出不断把最左边右括号变成左, 最右左括号变成右, 直到不能变了的情况下每个位置被弄到的次数, 设为 $x, y, z$ , 模拟一遍就出每个位置当前的值, 设当前位置堆三个颜色的操作次数为 $x', y', z'$ , 于是对每个位置就有了一个限制, 就是 $\min(x, x')+\min(z, z')>C$ , $C$ 是确定的常数, 于是把min拆开, 就成了关于 $x', y', z'$ 的线性规划, 合并限制后限制数量很少所以可以直接手枚顶点.

最后发现当枚举的 $c_i=0$ 的括号的和从大到小的时候, 可以维护 $x, y, z$ 每次最多变化1, 线段树合并限制, 复杂度1log.

### C0B 自身的成功

> 给定 $n\times m$ 的01矩阵, 每次可以把一个0变成1, 同一行同一列的1变成0, 给定两个局面问是否可以把第一个变成第二个.
> 
> $n, m\le 1000$

如果有一个0变成1, 并且这个1的同行同列有1, 那一定死了, 于是现在没有这种情况.

如果所有的都是1变成0, 最后全是0, 也死了.

考虑先把所有0变成1的点了, 一定不劣, 然后现在要清除所有1变成0, 那就找到一个可以操作的行/列(最后没有1), 然后用这行/列干掉这个1即可. 如果找不到就死了.

### C0C 阿克最最易

ZR题

### C0D 最成功捧杯

> 给定 $n\times m$ 矩阵, 你在奇数步可以横着任意走, 偶数步可以竖着任意走, 每个位置有颜色 $a_{i, j}$ , 求走 $k$ 步形成的颜色序列个数.
> 
> $n, m\le 10, k\le 600, a_{i, j}\in [1, 9]$

考虑dpofdp, 那么考虑给定一个颜色序列如何dp判断可行, 可以 $f_{i}=S$ 表示前 $i$ 位走完可能走到的点是集合 $S$ . 但这个内层状态过大: 可能有一种颜色出现次数很大, 所以考虑做到 $n, m$ 相关: 每一次对于一行/一列, 有多个颜色和有一个是一样的, 只要记录 $f_{i}=S$ 表示前 $i$ 个走完之后可以走的行/列的集合是 $S$ 即可, 此时内层状态数是 $k(2^n+2^m)$ .

然后考虑dpofdp, 扫掉一维 $i$ 后外层dp的状态是内层的值 $S$ , 于是 $f_{i, S, j}$ 表示颜色序列前 $i$ 个, 走到的集合是 $S$ , 最后一个位置颜色是 $j$ 即可, 预处理转移, dp复杂度是 $(2^n+2^m)k\Sigma$ .

## ZSContest 20221116 on Vjudge

赛时会3个, T4没longlong半天没查出来///fn

### abc259h

> 给定 $n\times n$ 矩形, 每个位置有值 $a_i$ , 只能往下或往右走, 问有多少起点终点值相同的格路径.
> 
> $n\le 400$

这里用 $n$ 表示题目中的 $n^2$

考虑两个很显然的暴力:
- 枚举颜色 $c$ , $f_{i, j}$ 表示以颜色 $c$ 开头走到 $i, j$ 的方案数dp.
- 枚举颜色 $c$ , 枚举 $c$ 中的两个位置, 以这两个位置为起点, 终点的路径是一个简单组合数.

于是根号分治, 出现次数大于 $\sqrt n$ 的用第一种, 出现次数小于 $\sqrt n$ 的用第二种. 第一部分复杂度显然 $n\sqrt n$ , 第二部分是

$$
\begin{gathered}
    \max \sum {a_i}^2\\
    s. t.
    \sum a_i=n
    \\ a_i\le \sqrt n
\end{gathered}
$$

这个式子量级是经典的 $n \sqrt n$

[think] 经典复杂度分析! 在做完SDOI2022D1T1后你又差点忘了.

### abc264h

> 给定 $T=Tree(n)$ , 对每个 $k$ 求只保留编号不超过 $k$ 的点的情况下 $T$ 有多少个导出子图是满二叉树(每个点有两个儿子, 所有叶子深度相同). 保证父亲编号小于儿子.
> 
> $n\le 3\times 10^5$

重点是, 因为是满二叉树, 所以二叉树深度只有 $\log n$ 量级.

于是直接dp, $f_{i, j}$ 表示点 $i$ 的子树内选深度 $j$ 的二叉树, 那么转移是简单的. 然后因为保证父亲编号小于儿子所以就算不断挂叶子, 因为只有深度在 $\log n$ 以内的节点可能对根的dp值有贡献所以每次暴力往上跳更新就是对的.

### abc255g

> $n$ 堆石子的nim游戏, 有 $m$ 个限制, 第 $i$ 个限制 $x_i, y_i$ 表示若一个石子堆剩余石子为 $x_i$ , 你就不能从其中拿走 $y_i$ 个. 问先手必胜/必负.
> 
> $n, m\le 2\times 10^5, a_i\le 10^{18}$

公平组合游戏, 只需要考虑求一个石子堆的 SG 值, 最后异或起来判断即可.

没有限制的时候显然是 $SG(x)=x$ , 那么加上限制之后会有若干个特殊点和若干段 $y=x+k$ 的一次函数. 没有限制的点的值显然是前面的最大值加1, 而有限制的点可以考虑维护每个 $SG(x)$ 的出现次数, 不断删掉被禁止的 $x$ , 找到最小的删没了的 $SG(x)$ 就是当前的SG值.

但是直接维护 $SG(x)$ 会爆炸, 但发现只维护特殊点的就行, 其他的位置的次数就是一个默认的 $1$ .

### abc264g

> 有 $n$ 个字符串, 每个字符串 $t_i$ 长度不超过 $3$ 且有权值 $p_i$ , 一个字符串 $s$ 的总权值为 $\sum_{i=1}^n cnt(s, t_i)\times p_i$ , 其中 $cnt(a, b)$ 表示 $b$ 在 $a$ 中出现的次数. 问长度任意的 $s$ 的权值是多少, 若可以无穷大输出 $\texttt{Infinity}$ .
> 
> $n\le 18278, \vert w_i\vert \le 10^9$

第一感觉是很离谱, 尤其是长度不限, 并且不会处理各个 $t$ 之间拼接之后包含的新的 $t$ .

这个长度3很特点, 发现如果长度2可以直接每个字母建一个点, 然后弄一下边权, 那么现在考虑直接建点 $(a, b)$ 表示当前字母是 $b$ , 上一个字母是 $a$ , 权值就又可以用点之间的边表示了.

注意起点终点和长度为1, 2的字符串的细节.

## NOIP模拟赛Day1

### A. string

> 给定 $S_n, T_m$, $q$ 次询问对于 $k$, 最小的 $p$ 满足 $p\cdot S$ 不是 $k\cdot T$ 的子序列. 乘法是重复若干次.
> 
> $n, m\le 5000, k\le 10^14, q\le 3\times 10^5$

处理从 $S$ 每个位置开始跑一个 $T$ 会匹配几个, 到哪.

然后再拼接这个, 显然最多 $n$ 次出循环, 找到循环次数并处理这 $n$ 次的答案即可 $O(1)$ 回答询问.

### B. path

> 给定 $Tree(n)$, $q$ 次询问对于 $x, y$ 有多少个路径恰好以 $x\to y$ 的链为交集. 膜 $998244353$.
> 
> $n, q\le 3\times 10^5$

等等, 这不是那个离谱lyh多项式题吗? K Path, 哦, 这是那个题 $k=2$ 的弱化.

那就考虑 $x, y$ 分成祖孙链和其他, 设 $f_u, g_u$ 表示从 $u$ 向子树内/外引两条链不交的方案数. 这个随便平方啥的搞一搞就行了.

最后统计答案就是, 如果 $x$ 是 $y$ 的祖先答案是 $g_xf_y$, 否则是 $f_xf_y$.

### C. triangle

> 给定 $Tree(n)$, 有边权, 对每个 $x$ 求所有有序对 $(x, y, z)$ 的 $dis(x, y)+dis(y, z)+dis(x, z)\pmod L$ 最小值.
> 
> $n\le 3000$

考虑三个点的虚树形成一个三叉, 那么显然一定要枚举一个三叉的中点.

注意到, 对于一个三叉, 至少有两个点在中点的子树里, 那么枚举这两个点, 就成了从两个集合各选一个数最大化它们的和膜 $L$. 这个只要直接二分即可. 如果外面有 $x$ 个点, 里面有 $y$ 个点, 复杂度就是 $(x+y)\log(x+y)$, 注意到 $\sum x$ 和 $\sum y$ 都是 $n^2$ 级别的.

另一个想法是直接枚举 $x$, 然后边分治.

### D. draw

> ![picture 1](/img/2022-11-22-14-50-33-image.png)  
> 
> $n, q\le 3\times 10^5, a_i\le 4$

一个暴力显然是每次从能打的里面拿最大的. 另外断坏成链也是经典套路.

这种打牌抽牌的一个经典套路是做前缀和描述当前手牌数变化.

考虑先确定打出的 $1$ 的数量, 显然只有更大的打完了才会用 $1$, 所以此时可以看成 $2, 3, 4$ 的牌都是拿到立刻打, 打够 $p$ 次说明没有 $1$, 中间没有 $2, 3, 4$ 打了的时候才会用 $1$. 这个可以用一个前缀和实现: 把 $1$ 当成 $0$(拿了也不打), 对当前手牌数做前缀和就是对于 $2, 3, 4$, $a_i=a_{i-1}+1, 2, 3$, 否则 $a_i=a_{i-1}-1$. 那么因为这个数组是可差分的, 找到第一个 $a_i<a_s+k$ 的就说明要打 $1$ 了, 也可以类比着找到所有打 $1$ 的位置. 这么往上弄就好了. 对这个倍增优化一下复杂度就1log.

另一个问题是要确定当前是否有比自己小的能打, 这个只要直接对着所有数前缀和即可求出一个边界满足在这个边界内总有非0牌可以打.

## KFC NOIP 2022(20221125wjw模拟赛)

### A. move

> 给定 $2n\times 2n$ 的棋盘, 有 $n^2$ 个棋子在左上角 $n\times n$ 的地方, 要都移动到右下角 $n\times n$ 的地方, 每次可以把一行棋子左右移动/一列棋子上下移动, 棋盘上有若干不能放棋子的障碍, 障碍有权值, 求移除最少障碍使得可以移动过去.
> $n\le 1000$

诈骗题(但被诈骗了), 只要考虑 $(1, 1), (1, n), (n, n), (n, 1)$ 四个位置的棋子要移过去要满足的条件是八个位置(固定的)中的一个没有障碍, 而其他棋子都可以通过这种方式移动走.

### B. path
> 给定 $Graph(n, m)$, 边有边权, $q$ 次询问 $u\to v$ 路径上边权序列的前缀与形成的集合的 $\operatorname{mex}$.
> 
> $n, q\le 10^5, m\le 5\times 10^5$

首先因为前缀与, 答案不超过 $2$(包含 $1$ 一定不会包含 $2$), 于是思考判定.

答案不是 $0$ 说明至少有一位全程都是 $1$, 那么对每位单独判保留这位是 $1$ 的边能不能连通, 并查集即可, 条件是至少一位的连通块不连通.

再考虑判定 $1$, 那么如果没有 $1$, 考虑是路径上在到 $0$ 之前一定都要在非末位上有 $1$, 那就是 $u$ 和 $v$ 的连通块之间用一条末位是 $0$ 的边连接即可, 仍然并查集维护连通块标记一下即可. 又因为可以走到0只要出去随便绕一绕总是能到 $0$ 的.

### C. sequence

> 给定 $a_n$, $q$ 次单点修改或者询问区间最大的 $a_i\operatorname{or} a_j, i\ne j$.
> 
> $n, q\le 10^5$

怎么没有切2500的ds啊///fn因为这是结论题///cf.

[conclusion] 值域小于 $2^k$ 的数中选两个数 $\operatorname{or}$ 起来最小的最小值出现在前 $k$ 个里.

于是直接线段树就是 $\log^2 n$

### D. color

> 给定 $Tree(n)$, 点有颜色 $c_i$, 求 $\sum_i ((\sum_j s(i, j)) \operatorname{xor} i)$, 其中 $s(i, j)$ 表示从 $i$ 到 $j$ 的颜色数.
> 
> $n\le 10^6$

#### 赛时做法

考虑一个换根(思路来自 P6556), 那么发现就是加上那些到这个点路径上没有当前颜色的点这样的贡献, 只要对每个颜色求虚树, 然后虚树dp即可, 另外就是可能会有求 $u$ 的一个是 $v$ 的祖先的儿子这样的会有 $\log n$.

常数写大了, 赛后在loj上看了下是能进1s的.

#### std

实际上不需要虚树, 考虑到当前这个点的路径上没有当前颜色的点形成的连通块只有 $O(n)$ 个, 所以直接求每个连通块大小即可. 可以线性.

#### 点分治

被wjw对着卡了. 复杂度1log.

## NOIP2022

输麻, 省队无缘

### A. plant

> 给定 $n\times m$ 01矩阵, 求有多少个1组成的C形和F形.
> $n, m\le 1000$

每个位置处理向下向右到哪, 然后简单前缀和/二阶前缀和统计.

**多测清空**

### B. meow

### C. barrack

> 给定 $Graph(n, m)$, 保证连通, 求有多少种方案选定一个点集, 再设立若干条关键边, 使得删去任意一条非关键边不会使点集不连通, 膜 $10^9+7$.
> 
> $n\le 5\times 10^5, m\le 10^6$

考虑直接边双, 接下来的问题是给定一棵树, 对每个虚树求有多少种边集可以连通它. 可以从点/边的角度出发.

从点的角度, 那么统计虚树, 设 $f_u$ 表示 $u$ 子树内选, 且点的虚树根为 $u$ 的方案数, 则答案是每个 $u$ 处统计上 $f_u$ 乘 $u$ 子树外的边的随便选的和, 设 $g_{u, 0/1}$ 表示去掉虚树根的限制, 根选/不选, 转移显然, 最后容斥一下可得到 $f$. 复杂度线性.


### D. match

> 给定 $a_n$, $b_n$, $q$ 次询问对于给定的 $[l, r]$, $\sum_{l'<r'\in [l, r]} \max_{i\in [l', r']} \max_{j\in [l', r']} a_ib_j$
> 
> $n, q\le 2. 5\times 10^5$

考虑扫描线, 对于给定的右端点 $r$, 设 $f_i$ 表示以 $i$ 开始的答案区间的答案, 那么询问就是求和, 每次右端点挪动的时候会给每个区间新加一个, 那么再维护两个区间对应最大值位置(从 $r$ 开始向前的前缀 $\max$), 就成了两个数组区间赋值, 以及区间加上他俩对应相乘, 可以线段树, 复杂度 $n\log n$.

## CF1793

好久文化课了

### A. Yet Another Promotion

显然

### B. Fedya and Array

> 构造最短的序列 $a$, 满足所有 $a_i>a_{i-1}, a_{i+1}$ 的 $a_i$ 和为 $x$, 同理小于的和为 $y$.
> $n\le 10^5$

考虑并观察样例, 如果 $a<0<b$, 构造是显然的, 直接用两个峰做完了, 那么整体平移一下就问题解决, 长度是 $2(b-a)$

### C. Dora and Search

> 给定排列 $a_n$, 求任意一个子区间满足左右端点不是区间内的最大/最小值
> 
> $n\le 2\times 10^5$

求每个数向左/向右作为最大/最小值的范围, 一个右端点的限制是左端点小于某个位置, 一个左端点的限制是右端点大于某个位置, 于是把左端点排序, 就扫右端点维护左端点即可吧

官方题解更简单: 从整个序列开始收缩, 显然如果当前区间 $[l, r]$ 的某个端点 $x$ 不满足条件, 则包含这个端点的前/后缀不满足, 于是直接收缩一个, 不断重复即可.

### D. Moscow Gorillas

> 给定排列 $a_n, b_n$, 求有多少个区间 $[l, r]$ 满足 $\operatorname{mex}(a_l\ldots, a_r)=\operatorname{mex}(b_l\ldots, b_r)$
> 
> $n\le 2\times 10^5$

那么肯定考虑枚举 $mex$ 求数量.

mex等于 $x$ 的要求是小于 $x$ 的必须包含且不包含 $x+1$, 从小到大枚举 $x$, 是不是随便做了.

### E. Velepin and Marketing

> 给定 $n$ 个元素和 $m$ 个集合, 每个元素有属性 $a_i$, 把元素分到集合中, 要保证每个集合中有至少一个元素, 且若一个元素 $i$ 所在的集合大小大于 $a_i$, 则元素 $i$ 是开心的, 求最大开心元素个数.
> 
> $n\le 3\times 10^5$

考虑对 $a$ 排序+二分答案 $x$, 显然最后要开心的是最小的 $x$ 个.

那么对于后 $x$ 个元素, 每个元素放入一个集合, 此时如果剩下元素, 就把剩下的和所有前 $x$ 个放到一个集合check, 否则从小往大放元素, 每次一个集合全部满足要求就切换到下一个集合. 这个部分可以预处理

towrite

### F. Rebrending

> 给定序列 $a_n$, $q$ 次询问区间 $[l, r]$ 中最小的 $\vert a_i-a_j\vert$.
> 
> $n\le 3\times 10^5$

是的大原题.

对于每个位置 $a_i$, 从左到右考虑 $j$ 是否能形成贡献, 此时假设现在已经有 $i, j$, 那么对于元素 $k$, 显然应该与 $i, j$ 近的那个贡献, 于是如果和 $i$ 贡献, 那么 $\vert a_k-a_i\vert \le \dfrac{1}{2}\cdot\vert a_i-a_j \vert$, 所以只有 $n \log n$ 对

直接主席树和二维数点复杂度2log

## 230218qyc contest

### A 秋天就要做偷橙子的梦

> 给定一个数列 $a_n$, 其中除了一个数之外每个都出现了 $k$ 次, 这个数小于 $k$ 次, 求这个数
> 空间限制1mb, $n\le 2\times 10^7, a_i\le 10^9$

有个广为人知题是所有数出现两次, 一个出现一次, 直接异或就做完了.

那么开始考虑k进制下不进位加, 发现只能扫两遍.

但实际上搞k进制不进位加是闲的, 直接二进制不进位加起来, 最后mod k就算完了.

现在复杂度瓶颈是对每一位分别求和, 实际上还可以优化到 $O(n)$ 而不是 $O(n\log v)$

考虑假设序列是静态的做法, 可以序列分治, 每次合并左右两边的 $\log v$ 个和, 此时合并可以做到 $\log n$, 方法是用 $\log n$ 个数, 其中第 $i$ 个数的第 $j$ 位表示第 $j$ 个和的第 $i$ 位是几, 合并的时候用加法器那一套就行了. 然后每次合并代价是 $\log len$, 所以总复杂度就线性.

此时变成动态的, 上一个二进制分组即可.


### B 你喜欢OI南桐轻小说吗?

> 计算两个序列 $a, b$ 的LPCS Longest Pairing Common Subequence, 也即一个最长的长偶数的序列 $c$, 设它的长度是 $k$, 它要满足对于正整数 $i\leq \frac{k}{2}$ 有 $c_{2i-1}=c_{2i}$, 且它同时是 $a, b$ 的子序列. 输出长度.
> 
> $n, m\leq 5000, a_i, b_i\leq 10^4$.
>
> 空间限制 $8mb$

考虑一个朴素dp, $f_{i, j}$ 表示已经选了长 $i$ 的, 其中在 $a$ 中最后一个选的是 $a_j$ 的情况下, $b$ 数组中最后一个最早是谁.

前缀和优化转移显然, 问题在于转移需要 $O(1)$ 算 $nxt(j, a_i)$ 表示在 $i$ 之后第一个 $a_i$ 的位置, 直接存显然爆了.

于是常数比较小时间换空间冲了.

好吧实际上, 你用 $f_{i, j}$ 表示 $a$ 里选了 $i$ 个, $b$ 里选了 $j$ 个的方案数, 此时假设先扫第一维, 就只会从 $(last_a(i), j')$ 转移来, 其中 $b_{j'}=a_i$, 所以复杂度是奇妙的线性.

### C 关于摆烂地交通部长摆烂这档事

> 给定一张 $DAG(n, m)$, 求有多少个点满足它能到达和能到它的恰好是全部的点.
> $n\le 5\times 10^5, m\le 10^6$

考虑把DAG从左往右摊开, 可以删掉跨过这个点的边(从这个点左边到右边), 那么发现在剩下的图中满足条件等价于左边的点出度不为0, 右边的点入度不为0.

于是要维护一个删边情况下每个点的出入度, 注意到按照拓扑序遍历点的时候每个边影响一个区间, 于是差分贡献就能做到线性.

## 230318qyc contest

### F - Figglypuff Gym - 102341J 

直接猜结论

但把一个简单代码写复杂了, 太久不写代码///fn

### E - Enteractive Vertex

首先这种东西肯定让你二分, 你一想可以用 $\log n$ 的代价得到特殊点在某个点的哪个子树里, 那么肯定上一个点分治, 目前可以卡到 $2\log n$

注意到, 如果卡成 $2\log n$ 一定是这个点有一堆特别小的子树, 那么按子树大小排序, 找到前 $k$ 小使得它们大小之和恰好大于一半, 先确定答案是不是在这一半里, 简单分析发现变成了单log

### B - Brammarly Gym - 102331G 

第一眼想建SAM, 多看几眼发现如果走重一定是一个相等的段, 变成了简单组合题.

### D - Dypno Gym - 102341H 

考虑可以用 $\dfrac{3}{2}$ 的代价硬通过一条边, 或者去试探.

那么对于一个点, 最优策略一定是从能到的点中, 最小的到更大的去试探一个前缀, 当试探后的收益小雨直接冲就不试了.

那么这个已经可以dp了, 用dij优化, 注意到对于两个点可以根据它们答案最小的后继的答案去比较(放到dij的堆里).

### A - Aevee Gym - 102341E     

考虑容斥, 计算有 $k$ 个不合法长 $l$ 段的方案数, 那么组合数就是每个栈第一个不合法的往上随便拿, 然后连着拿这 $l$ 个, 然后再随便拿. . . , 注意到若有两个都不合法, 则一定要满足这两个颜色在每个栈里都是一个在另一个上面, 于是你设 $f_i$ 表示以 $i$ 颜色结尾的LCIS的贡献(带容斥系数)去dp.

那么你枚举一个左端点, 开始往右扫右端点, 注意到每次往右延伸一个右端点时, 一个 $i$ 所能转移到的 $j$ 就会减半, 在一次向右扫的过程中, 每个 $i$ 只会转移线性次, 所以复杂度是 $nk\max(n, k)$ 这样的.
