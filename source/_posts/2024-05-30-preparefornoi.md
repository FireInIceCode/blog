---
title: 2024NOI准备
subtitle: 单纯是以前的blog有点长新开一篇
layout: post
show: true
top: false
tags: 
- 日志
- 杂题
---

# 2024NOI准备

### [ABC225H] Social Distance 2

考虑 $k$ 个确定的人把问题分成若干长度固定的段, 设长 $l$ 的段内有 $j$ 个人的贡献和是 $f_{l, j}$, 则 $[x^{m-k}] \prod_{l\in S} \sum_j f_{l, j}x^j$ 即为答案.

考虑 $f_{l, j}$ 怎么求, 显然相当于 $j+1$ 段, 和为 $l+1$, 求每段长度乘积的和, 这个是经典的, 一段的贡献显然是 $\dfrac{x}{(1-x)^2}$, 于是总贡献是 $\dfrac{x^{j+1}}{(1-x)^{2j+2}}=\binom{l+j+1}{l-j}$ 即可.

然后两端点的段要特殊处理(不含第一段的贡献), 方法一样.

### [ARC101F] Robots and Exits

容易发现洞把序列分成若干段, 对于任意一段其一定是左边的点从左边出右边的点从右边出, 所以其实相当于数合法 $01$ 序列, $0$ 表示某个机器人从左边出 $1$ 表示从右边出. 然后考虑段间的限制, 设 $i$ 到左右出口的距离分别为 $l_i, r_i$, 则 若 $l_i>l_j, r_i<r_j$, 则有 $a_i=1\to a_j=1, a_j=0\to a_i=0$.

那么所有选 $0$ 的顶层区间(没有祖先选 $0$), 容易发现它们唯一确定了方案, 要求仅为不能有包含关系, 于是按 $l$ 排序就是简单二维数点.

或者看成把 $(l_i, r_i)$ 画到平面上, 那么相当于选了一条左下到右上的分界线.

复杂度单log.

### [AGC032F] One Third

考虑相当于每次插入一个红点后就在左右各 $\dfrac{1}{3}$ 处分别放置蓝点和绿点, 最后求最小的异色点对距离.

则按照第一次插入把环分成三份, 容易发现三份是等价的, 则问题变成了给定一条长 $l$ 线段, $n-1$ 次随机一个位置随机一个颜色放一个点, 问最小异色点对距离期望.

考虑怎么去除异色的限制, 考虑枚举前 $k$ 小的段都是同色的, 容易发现概率是 $\dfrac{1}{3^k}$. 那么只要计算长 $l$ 的线段上随机撒 $n-1$ 个点, 第 $k$ 段期望长度.

那么最短的是好求的:

$$
E(X)=\int_0^{\frac{l}{n}} P(X\ge x)dx = \int_0^{\frac{l}{n}} (l-nx)^{n-1}dx=\dfrac{1}{n^2}
$$

这里第二个等号是考虑相当于分成 $n$ 个长至少为 $x$ 的线段, 则先把它们减去 $x$ 就成了在 $1-nx$ 的线段上选 $n-1$ 个点.

考虑次短, 相当于剩下 $n-1$ 段中最小值, 则先都减去最小值, 于是有

$$
E(X_2)=E(X)+\int_0^{\dfrac{1}{n}} P(X=x) \dfrac{l-nx}{n^2}dx=E(X)+\dfrac{1-nE(X)}{(n-1)^2}
$$

得到

$$
E(X_k)=\dfrac{1}{n}\sum_{i=0}^{k-1} \dfrac{1}{n-i}
$$

就做完了.

### [AGC044E] Random Pawn

随机游走题, 设从位置 $i$ 开始最大期望价值为 $f_i$($0$ 起始), 有

$$
f_i=\max(a_i, -b_i+\dfrac{1}{2}(f_{i-1\bmod n}+f_{i+1\bmod n}))
$$

显然 $a$ 最大值处 $mx$ 有 $f_{mx}=a_{mx}$, 断环成链.


想起来 $b_i=0$ 的时候这个题是 USACO 2018 P A. Balance Beam, 考虑如何转化. 则设一些系数 $c$ 使得令 $g_i=f_i+c_i$, 有 $g_i=\max(a_i+c_i, -b_i+\dfrac{1}{2}(g_{i-1}+g_{i+1}-c_{i-1}-c_{i+1}))$, 则只要 $c_{i-1}+c_{i+1}=-2b_i$, $c$ 是容易递推的.

### [ARC133E] Cyclic Medians


好巧妙

不知道干啥就先拆贡献, 转化成最后 $a\ge x$ 的方案数, 则容易想到 $<x$ 的数为 $0$, $\ge x$ 的数为 $1$, 称 $a$ 改变当且仅当 $x=y$(此时后面的状态与前面无关), 分类讨论:

若存在 $x=y$, 则 $a$ 于 $A$ 无关, 发现已经没有什么阻止它对称了, 也就是 $x$ 的方案数和 $x, y$ 都翻转后 $V-x+1$ 的方案数是一样的, 而 $x, y$ 翻转会让不合法和合法翻转, 于是 $cnt_x+cnt_{V-x+1}$ 就是总方案数减去不存在 $x=y$ 的方案数再除 $2$.

对于不存在 $x=y$, 限制是很严格的: 设 $g=\gcd(n, m)$, 则有序对 $(x_i, y_j)$ 存在当且仅当 $i\equiv j\pmod g$ 的, 把所有模 $g$ 相等的位置拿出来设为 $S$, 则 $\forall i, j\in S, x_i=x_j, y_i=y_j, x_i\ne y_i$. 于是方案数可以直接统计了.

复杂度除快速幂和 $\gcd$ 外线性.

[think] 核心性质: 对称

### [ARC133F] Random Transition

[trick] 考虑转化问题, 把 $\dfrac{x}{n}$ 的概率加一否则减一的概率凑出来, 则对于一开始在 $a$, 最后为 $b$ 的概率, 等价于 $n$ 个硬币有 $a$ 个正面向上, $k$ 次随机翻一枚, 最后有 $b$ 个正面向上的概率.

那么每个硬币独立了, 于是设EGF, 用 $x, y$ 表示翻动次数和硬币个数, 有

$$
\begin{gathered}
    F_0(x)=\sum_{2\nmid i} \dfrac{(x/n)^i}{i! }y+\sum_{2\mid i} \dfrac{(x/n)^i}{i! }=\dfrac{(1+y)e^{x/n}+(1-y)e^{-x/n}}{2}\\
    F_1(x)=\sum_{2\nmid i} \dfrac{(x/n)^i}{i! }+\sum_{2\mid i} \dfrac{(x/n)^i}{i! }y=\dfrac{(1+y)e^{x/n}-
    (1-y)e^{-x/n}}{2}
\end{gathered}
$$

则答案的EGF是

$$
\begin{gathered}
    Ans(x)=m! n^{-m}[x^m]\sum_i w_i F_1^i(x) F_0^{n-i}(x)\\
    \text{let}\ A(x)=(1+y)e^x, B(x)=(1-y)e^{-x}. \\

    Ans(x)=m! n^{-m}2^{-2n}[x^m]\sum_i w_i(A+B)^i(A-B)^{n-i}
\end{gathered}
$$

考虑 $A^iB^{n-i}$ 的系数即

$$
\begin{gathered}
    [x^i]\sum_i w_i(x+1)^i(x-1)^{n-i}=\\
    [x^i] (x-1)^n\sum_i w_i (\dfrac{x+1}{x-1})^i
\end{gathered}
$$

于是对 $\sum_i w_ix^i$ 多项式复合得到和式部分, 再卷 $(x-1)^n$ 即是系数多项式设为 $\sum_i c_ix^i$.

则 $[x^m]\sum_i c_iA^iB^{n-i}=[x^m]c_ie^{(2i-n)x} \cdot (1+y)^i(1-y)^{n-i}=c_i\dfrac{(2i-n)^m}{m! }(1+y)^i(1-y)^{n-i}$

和上面的形式一样! 于是 $y$ 的系数直接就取出来了.

### [ABC238Ex] Removing People

时间倒流考虑往位置填人, 要求是加人时有一个相邻点指向自己, 此时有一个很局部的性质, 这个点的贡献只和相邻点有关. 于是考虑区间dp, 设 $f_{l, r}$ 表示 $l, r$ 已经加入, 然后填好中间的这个方案数. $g_{l, r}$ 表示权值和.

转移就是考虑第一下填到哪, 然后把两边乘起来分配标号.

### P7718 「EZEC-10」Equalization

显然要差分 $c_i=a_i-a_{i-1}$, 考虑如果你的操作有一端连着端点那么相当于单点修改, 否则是给 $c_i\gets c_i+x, c_j\gets c_j-x$ 这样.

那么对第二类的修改连边 $i\to j$, 最优解一定形成若干棵树, 对每棵树如果所有点原来的 $\sum c_i\ne 0$ 还必然要用一次单点修改. 于是去dp子集划分即可, 每个子集对应一棵树.

然后要求方案数, 显然不会有相同的方案, 算一棵树的时候上个Caylay, 对于有自环的多乘个 $2n$($2$ 是因为单点修改可以操作 $[1, x]$ 也可以操作 $[x, n]$), 就做完了.

复杂度 $3^n$

### Shake It!

首先转化成最大流.

设 $f_{i, j}$ 表示 $S\to T$ 形的图操作 $i$ 次得到的图有 $j$ 的流量, $g_{i, j}$ 表示 $S\to a\to T$ 形的图操作 $i$ 次有 $j$ 的流量, 则 $g_{i, j}=\sum_{k, a, b, \min(a, b)=j-1} f_{k, a}f_{i-k, b}$. 是显然的, 复杂度是 $n^4$, 而 $g$ 转移到 $f$ 的时候注意此时 $g$ 中相同的方案是不区分的, 则枚举 $i, j$ 的方案用了多少个, 有 $f_{i, j}=f_{i-kj, j-kj}\cdot \binom{g_{i, j}+k-1}{k-1}$. 就做完了吧!

### [ABC231G] Balls in Boxes

对一个盒子: $F(x)=\sum_i (a_i+i)x^i=(a_i+x)e^x$, 卷起来提取 $k$ 就是答案.

要算

$$
[x^m]e^{nx}\prod_i (a_i+x)
$$

右边次数很低, 诶这不做完了?

### [ABC242Ex] Random Painting

小球是在干什么, 装神弄鬼, 随机一个区间的意思

但是好厉害的题

显然可以离散化令 $n$ 变成 $m$ 的同阶.

#### Sol1

一个做法是min-max反演, 考虑对于一种方案, 所有方块被染色的时间组成多重集 $S$. 则

[trick] $\max(S)=\sum_{T\subset S} (-1)^{T+1} \min(T)$, $E(\max(S))=\sum_{T\subset S}(-1)^{T+1} E(\min(T))$.

于是考虑求一个子集的最小覆盖时间期望, 即第一次存在一个区间和这个集合有交的期望. 若与集合 $T$ 相交的区间有 $k$ 个, 显然期望是 $\dfrac{m}{k}$, 则dp设 $f_{i, j}$ 表示考虑前 $i$ 个格子的子集合 $T$, $i$ 必选, 与 $T$ 相交的区间有 $j$ 个的带容斥系数方案数. 转移是考虑上一个选择的元素 $j$ 从 $j$ 转移过来. 暴力复杂度是 $n^2m$. 可以线段树做到 $n^2\log n$

#### Sol2

考虑一个状态 $S$ 是当前已经染色的区间的集合, 显然转移形成dag, 有

[trick] 对DAG, $\text{停时期望}=\sum_{S\text{不合法}} \text{S出现的概率}\times \text{离开状态S的期望时间}$.

离开有 $S$ 的期望时间显然是 $\dfrac{m}{\vert S\vert}$, 则要算 $p_i$ 表示选了 $i$ 个区间还没结束的概率.

哦, 做法一等价于算这个的时候用二项式反演钦定若干点必然不被覆盖吧

dp, 把区间按左端点排序, $f_{i, j, k}$ 表示考虑前 $i$ 个区间, 覆盖了 $[1, j]$, 选了 $k$ 个区间, 当前区间必选的概率, 转移只要求上一个区间的右端点能覆盖当前区间左端点.

注意到 $k$ 和给定区间无关, 设 $F_{i, j}(x)=\sum_{k=0}^m f_{i, j, k}x^k$, 则可以用同样的方法对任意常数算 $F_{i, j}(C)$, 于是最后来一个拉插就行了.

[trick] dp时强硬的用多项式表示一维并维护点值

复杂度和上面的做法一样.

### P4707 重返现世

随便开一个minmax反演题. 来学minmax容斥证明, 基本思路就是 $C_1(S)=\sum_{T\subset S} f(T)C_2(T)$, 其中 $C_1, C_2$ 可能是第几大/小状物, 然后改为枚举右边 $C_2(T)$ 的值列组合数, 再套一下二项式反演.

这个题要求第 $k$ 小, 但其实第在知道集合总大小的情况下第 $k$ 小和第 $k$ 大是一样的, 发现对于一个集合它的最小值是好球的, 我们来推一推. 我们希望有 $\mathrm{kthmin}(S)=\sum_{T\subset S} f(\vert T\vert)\min(T)$

考虑右边枚举最小值在集合中的 $rank$ 是 $y$(集合最小值rank为 $1$)值是 $v_y$, 则为 $\sum_{y=1}^{\vert S\vert} v_y\sum_{i=1}^{\vert S\vert-y+1} \binom{\vert S\vert-y}{i-1}f(i)$, 于是要求 $\sum_{i=1}^{\vert S\vert-y+1} \binom{\vert S\vert-y}{i-1}f(i)=[y=k]$, 这不是二项式反演吗, 于是 $f(i)=\binom{i-1}{\vert S\vert-k}(-1)^{i-\vert S\vert+k-1}$

于是这个题, $\mathrm{kthmin}(S)=\sum_{T\subset S}\binom{\vert T\vert-1}{\vert S\vert-k}(-1)^{\vert T\vert-\vert S\vert+k-1}\min(T)$.

于是我们想算 $g_i=\sum_{\vert T\vert=i} \dfrac{m}{\sum_{j\in T} a_j}$, 对所有的 $i$.

直接背包显然爆炸了, 也就是我们不能把 $i$ 割裂的做, 需要整体维护, 注意到 $g_i$ 在答案中的贡献系数是 $(-1)^{i}F(i)$, $F$ 是不超过 $11$ 次的多项式或者说组合数, 于是做完了. 复杂度 $nmk$.

### P5244 [USACO19FEB] Mowing Mischief P

$S$ 中的点两人都要经过, 所以容易发现相当于选若干个点 $(x_1, y_1)\ldots (x_k, y_k)$, 最大化 $k$ 再最小化 $\sum_i (x_i-x_{i-1})(y_i-y_{i-1})$.

那么直接dp, 设 $f_i$ 表示以 $i$ 点为结尾的序列长度, $g_i$ 表示面积, 那么 $g_i$ 只能从 $x_j\le x_i, y_j\le y_i, f_i=f_j+1$ 的地方转移过来. 那么你按照 $f$ 排序转移.

那么 $g_i=g_j+(x_i-x_j)(y_i-y_j)$, 但问题是变量有两个, 贡献形式形如($x_iy_j+x_jy_i+C_j$).

考虑决策单调性, 按 $x$ 排序, 同一层节点一定是 $y$ 单调递减的, 发现 $j$ 有决策单调性(容易发现交叉劣于包含), 随 $i$ 增加 $j$ 减少, 但是还有区间限制, 不同区间限制的决策点不好处理.

那就都搞成同一区间限制, 线段树分治, 把每个区间都拆到线段树上, 同一节点的限制就相同了. 复杂度俩log.

### P3438 [POI2006] ZAB-Frogs

二分答案, 只保留大于 $x$ 的, 判连通性, 复杂度是 $nm\log n$, 只要想办法对每个点求最近的坏点距离. 一行一起做是斜率优化.

### CF878D Magic Breeding

还挺巧妙.

对值域为 $01$ 的时候, 容易bitset, 同时注意 $n$ 维只有 $2^k$ 种本质不同的情况, 复杂度是 $\dfrac{2^kq}{w}$

对于原题, 考虑 $n$ 维是独立的, 可以先把每维离散化到 $1\ldots k$, 此时值域只有 $1\ldots k$, 再把每个数 $x$ 拆成 $k-1$ 位 $[x>1], [x>2]\ldots [x>k-1]$, 就做完了!

### The Ultimate LIS Problem

显然 $n$ 和 $2n+1$ 是有深意的.

考虑LIS转化成最小链覆盖, 然后构造长度分别为 $2, 2, 2, 2, \ldots 3$ 的解.

那么 $2$ 想到匹配, 于是把 $n+1$ 拿出来, $[1, n]$ 的看成右括号, $[n+2, 2n+1]$ 看成左括号, 左右括号数量相等必然存在一个位置可以转的合法, 先转过去.

然后此时如果 $n+1$ 在至少一个匹配的括号对里面显然直接做完了, 否则我们可以把它转到开头, 它必须要当左括号, 则意味着后面必须有两个左括号可以合并, 即 $[n+2, 2n+1]$ 不为升序, 那么一定可以做到. 同时还可以把 $n+1$ 放在最后判定是否有两个右括号可以合并.

那怎么证必要啊, 考虑你总可以把 $n+1$ 转到头上, 刚才说明任意两个左括号不可合并, 任意两个右括号不可合并, 看起来就真的无解了.

然后看下怎么求 $k$ 了, 维护一个括号序, 需要支持单点修改, 找到前缀和的最小值, 循环移位, 找到任意两个同色位置 $i, j$ 满足 $i<j, a_i>a_j$. 平衡树即可.

### [AGC038E] Gachapon

设 $p_i=\dfrac{A_i}{S}$, 枚举最后一个元素并在时间轴上分配标号:

$$
1+L(\sum_i p_i \dfrac{(p_ix)^{B_i-1}}{(B_i-1)! }\prod_{j\ne i} (e^{p_jx}-\sum_{k=0}^{B_j-1}\dfrac{(p_jx)^k}{k! }))'\circ 1
$$

显然可以设 $P_i(x)=e^{p_ix}-\sum_{j=0}^{B_i-1} \dfrac{(p_ix)^j}{j! }$, $Q(x)=p_i\dfrac{(p_ix){B_i-1}}{(B_i-1)! }$, 那么我们想求 $[y^1]\prod (P(x)+Q(x)y)$.

那么 $P, Q$ 都作为二元多项式 $Poly(x, e^x)$, 复杂度好像有点超标.

但是, 如果我们对每个 $y$ 维护 $x$ 的点值多项式, 则卷一次是 $n^2$, 一开始为每个 $P_i, Q_i$ 算点值复杂度是 $n^2$, 最后插值回来复杂度是 $n^3$!

也有min-max反演+dp的做法.

### [AGC021F] Trinity

考虑从左到右每次填一列, 那么容易想到设 $f_{i, j}$ 表示填了前 $i$ 列, 还有 $j$ 行没有填东西的方案数.

转移是分类讨论, 如果没有新占一列方案数显然是 $\binom j0+\binom j1+\binom j2$, 否则新占 $k$ 列, 如果贡献均来自新占的数, 方案数是 $\binom{k+j}{k}$, 如果只有一个来自其中是 $2\binom{k+j}{k+1}$(作为最大或最小乘 $2$), 否则都来自原来的数是 $\binom{j+k}{k+2}$.

于是 $f_{i, j}(\binom{j}{0}+\binom{j}{1}+\binom{j}{2})\to f_{i+1, j}, f_{i, j}\binom{j+k+2}{k+2}\to f_{i+1, j+k}$

加速转移, 对于第二个转移相当于egf卷 $\sum_k x^{k+2}$, 于是就ntt了.

然后可以不用ntt, 写成GF是二元($e^x, x$ 两元)$m$ 次的多项式, 可以直接转移做到 $m^3$

### CF1205F Beauty of a Permutation

见到这个是不是该考虑析合树, 只考虑每个点儿子的贡献, 析点有 $i$ 个儿子贡献 $i$, 合点贡献 $\dfrac{i(i+1)}{2}-1$(都不计算自身, 应该被父亲算).

然后直接对着这个dp就好了啊.

### [ARC124F] Chance Meeting

容易想到两人坐标作差, 则实际上只有三个操作(A向下和B向上相同), 那么相当于从 $(0, 0)$ 开始每次向上/左/右走一步, 要求经过 $(0, n)$, 最后到达 $(0, 2n)$ 的方案数.

考虑从 $(0, 0)$ 用 $k$ 步走到 $(0, n)$ 方案数显然是 $\binom{k}{n, (k-n)/2}$, 但这样可能多次穿过 $(0, n)$, 设这个方案数是 $g_i$. 而用 $k$ 步穿过一次的方案数显然是卡特兰数容易计算, 设卡特兰数 $c_i$, $C(x)=\sum_i c_ix^i$, $f_i$ 表示走 $i$ 步第一次到达 $(0, n)$ 的方案数, $F(x)=\sum_i x^i$, 则显然 $G=F\dfrac{1}{1-C}$, 于是 $F=G(1-C)$. 答案只要求 $F^2$.

### [ABC254Ex] Multiply or Divide by 2

把乘$2$看成对$b$做除法,则可以把值域控制下来,且很有单调性.

于是考虑两个集合中的最大值,若它们相等显然应该直接匹配掉,否则尝试把大的除以$2$或判断无解.

### [ABC245Ex] Product Modulo 2

看起来可以对每个质因子单独做.现在对$p^a$做$n'=n\bmod p^a$的子问题.

若$n'\ne 0$

若$n'$中$p$的次数为$x$,那么可以把$p$的因子分开,如果一个位置选了$p^i$,那么非$p$因子可以在模$p^{k-i}$下选.选$p$因子的方案数显然是$\binom{k+x-1}{k-1}$.

对于非$p$因子部分,相当于在以$p^{a-x}$中与$p$互质的数构成的乘法群里算,容易发现得到每个元素的概率相等,那么只要算总方案数除以$\varphi(p^{a-x})$.显然若位置$i$选了$p^i$,那么它有$\varphi(p^{a-i})=p^{a-i-1}(p-1)$种方案.这部分的方案数是$\dfrac{p^{k(a-1)-x}(p-1)^k}{p^{a-x-1}(p-1)}=p^{(k-1)(a-1)}(p-1)^{k-1}$.

若$n'=0$,直接把所有不等于$0$的减掉即可.

### [ARC126E] Infinite Operations

先把数组排序.

容易发现最后一定都是平均值.

不容易发现最优策略一定是每次操作数组相邻两项,而答案就是$\dfrac{1}{2}\sum_{i<j} \vert a_i-a_j\vert$.

有了这个直接动态开点线段树就好了.

[think] 不知道干啥你就排个序,另外记得玩样例.

### [ARC126F] Affine Sort

考虑设$f(x)$表示$c=x$时的对答案,则$F(k)=\sum_{i=1}^K f(x)$,如果$f(x)\sim ax^2$,那么发现$F(k)\sim \dfrac{1}{3}ax^3$.于是如果能求得$\dfrac{f(x)}{x^2}$的极限就赢了.

那么考虑要求$ax_i+b$单调,等价于要求$\dfrac{ax_i+b}{k}$单调,$k$足够大时,问题近似是$[0,1)$间连续的.相当于对问题$ax_i+b \bmod 1$单调,$a,b\in [0,1]$的问题答案做二元积分.

那么对每个$a$考虑合法的$b$的范围,则存在$b$的条件是$ax_i$是递增排列的循环位移,或者说放在一个圆上它们顺时针转.此时$b$的范围是$a(a_n-a_1)$.

考虑如何刻画循环位移,等价于$\sum_i w(x_i,x_{i+1\bmod n})=1$,$w(a,b)$表示顺时针$a\to b$的距离.这个的意思是这么走只会在圆上转一圈.

则注意到$w(x_i,x_{i+1})$是关于$a$的$O(\vert x_1-x_2 \vert)$段函数,于是它们的和是不超过$\sum_i x_i\le 5\times 10^5$段函数,每段的值是一个常数,分段对$b$积分即可.

### [ARC128F] Game against Robot

设$n$是$\dfrac{N}{2}$

先考虑$p$固定怎么做,设你选择的第$i$个数会被对面第$r_i$次选,那么能选它的条件是$\sum_{j<i} [r_j<r_i]+i-1<r_i$,感觉很复杂.

注意这时两个人不是对称的,考虑对面选的第$i$个数它本来应该在第$r_i$次选,那么这个数满足$r_i\le 2i$.而你是倒数第$i$次取的数在后$2i$名.

那么直接把序列反过来,要求你取的第$i$个数满足$r_i\in [1,2i]$,这时候就可以贪心了啊,显然每次会选当前能选集合中的最大数.每次加入前面两位,再删掉集合最大值.

显然要拆贡献,计算$i$被计算的次数.那么对这种比大小的考虑缩减值域,可以变成算前$k$大被算的总次数,就可以把前$k$大设为$1$剩余的设为$0$.

那么从前往后每两位分为一组,设当前集合中$1$的个数为$x$,每次显然是$x\gets \max(0,x+c_i-1)$,其中$c_i$表示第$i$组中$1$的个数.而$x$取$0$时就是选了一个$0$.

画到平面上,对应了一个每一步走$(1,1),(1,0),(1,-1)$的折线,对应$c_i=2,1,0$,而如果这一步跨过$y=0$($c_i=0$且$x=0$)就掰直成走$(1,0)$.然后我们要数掰直次数不超过$k$的折线.

考虑去掉max,则原来每个掰直都会作为现在新的前缀min,最后就要求全局最小值大于等于$v(v<0)$,即选了$n+v$个$1$,限制类似卡特兰数,考虑反射容斥.

那么先要会算从$(0,0)$走到$(x,y)$的方案数,即$[z^y] (z+2+z^{-1})^n$(注意$c_i$=1的方案数是$2$).

$$
\begin{gathered}
    [z^y] (z+2+z^{-1})^x\\
    =[z^y]z^{-x}(z^2+2z+1)^x\\
    =[z^{x+y}] (z+1)^{2x}\\
    =\binom{2x}{x+y}
\end{gathered}
$$

于是反射容斥,$\sum_i c_i=k$所以要走到$(n,k-n)$,则若接触$y=v-1$反射后要走到$(n,2(v-1)-k+n)$就是$\binom{2n}{n+k-n}-\binom{2n}{2(v-1)-k+2n}=\binom{2n}{k}-\binom{2n}{k-2v+2}$.那么最小值恰好为$v$的方案数就是$\binom{2n}{k-2v}-\binom{2n}{k-2v+2}$.

要求答案注意要再乘$0$和$1$内部相对顺序.

### [ARC115E] LEQ and NEQ

简单题,对条件容斥,然后一段的权值是最小的$a_i$,则建笛卡尔树后在上面dp即可.

诶,可以直接二维dp再数据结构优化一维.

### [ARC112E] Cigar Box

显然对一个数的操作只有最后一次有效.

考虑划分成不动,到前面,到后面$3$个集合,要求不动的集合递增,然后三个集合的值域递增.

那么几乎做完了,显然不动的集合在$a$上一定是个区间,那么确定这个区间后,设左边有$A$个,右边有$B$个,则操作可以依据操作的数分成$A+B$类,方案数是${m\brace A+B}$,对每个数的最后一次操作显然已经确定方向,前面的任意,所以乘$2^{m-A-B}$,向左和向右互不影响卷起来,乘$\binom{A+B}{A}$

### [ARC124E] Pass to Next

考虑设第$i$个人传给下一个人$x_i$,要满足$x_i\le a_i$,则贡献是$\prod_i (a_i+x_i-x_{i-1})$

那么考虑如果是个序列,考虑经典的等于每一个里选一项乘起来算贡献,那么对于当前第$i$个括号,若选择$a_i$则不管这一位$x$是多少都是$a_i$,若选择$x_i$是一个等差数列求和,若选择$x_{i-1}$,则需要和上一项合并是一个平方求和,就能转移了.

然后因为是环需要断开,枚举第一个括号选的哪一项即可.

### [ARC138E] Decreasing Subsequence

考虑让所有$a_i\ne 0$的$i$向$a_i-1$连边,则合法情况下每个点只能向前连边,又因为互不相同一定形成若干条链,每个链是有序的,也就是相当于划分了若干个集合.

然后考虑一个长$k$的下降序列,表现为$k$条边$r_1\to l_1\ldots r_k\to l_k$,满足$l_1\le l_2\le \ldots l_k\le r_k \le \ldots r_2\le r_1$,则容易发现所有点会被这些边分成值域不交的两部分.于是直接枚举这两部分的大小,注意到确定这两个集合后
