---
title: 南外省选集训
subtitle: 
layout: post
show: true
top: false
tags: 
- 日志
password: usbombnlm
---

# NOIP后南外省选集训

## NOI2024省选训练赛5

### A. 两棵树

原题是BZOJ crash和陶陶的游戏

> ![picture 0](/img/2023-12-12-18-57-55-image.png)  
>
> $n\le 10^5$

考虑加入一个 $A$ 树的叶子对答案的贡献是 $B$ 中的祖孙链上的子串数, 更好的是 $A$ 这个叶子作为 $B$ 字典树上的后缀的个数, 加入 $B$ 的叶子相当于对 $A$ 的字典树的一条从根的链求和.

具体的考虑如何解决 $A$, 相当于求字典树的子串出现次数, 相当于阿狸的打字机带修. 或者考虑直接求出 $B$ 字典树上所有字符串的字典序排序, 这样包含一个串的一定是一个后缀, 就是区间问题了.

考虑如何解决 $B$, 需要先匹配一下 $B$ 这个叶子往上跳多远还在 $A$ 里, 然后随便求和.

于是可以维护出 $B$ 中每个点 $u$ 向上跳 $2^i$ 步的hash值, 这个可以同时用于求字典序排序和 $B$ 这个叶子往上跳多远的问题.

### B. 头文字 O

> 你在无限的数轴上从 $0$ 开始随机游走 $n$ 步, 每次位置 $+- 1$, 由 $m$ 个给定的区间, 若你的路径中存在一段以 $s_i$ 开头, $t_i$ 结尾则会获得 $v_i$ 价值, 求价值期望.
> 
> $n\le 2\times 10^5, m\le 5\times 10^5$

一眼反射容斥.

然后做这个题的时候以为它数轴有界, 这时候两边都要反射情况有点多.

首先期望线性性, 对每个 $s, t$ 算, 如果 $s<0$ 你可以把 $s, t$ 都取负, 如果 $t<s$ 可以把 $t$ 对称到另一边,**这样走到 $s$ 之后的路径对称构成双射**.

于是很棒的, $0<s<t$, 这意味着我们只用管经过 $t$ 这个条件, 这就先求不经过 $t$ 的, 枚举终点后是经典反射容斥, 对所有终点累加是上指标均为 $n$ 的组合数之和, 前缀和即可.

如果没有观察到双射怎么处理, 那就枚举一个步数 $l$, 先走到 $s$ 的方案数和从 $s$ 出发走 $l$ 步不经过 $t$ 的方案数卷起来, 硬推组合式应该也能做.

### C. 慈善

> ![picture 1](/img/2023-12-12-19-29-50-image.png)  
> 
> $n, m\le 2\times 10^5, C, a, b, c, d\le 10^{18}$

考虑一些dp, 比如 $f_{i, j, k}$ 表示 $i$ 时刻两人收益分别为 $j, k$, 然后你会想到相当于维护点集 $(j, k)$, 在处理两人一起抽卡的时候应该发现维护 $k-j, k$ 比 $j, k$ 好, 然后三种情况(小H抽, 小X抽, 一起抽)就是点集和向量做闵和, 然后你又想到点集其实只有 $y$ 最大的有用也就成了函数, 于是开始维护函数.

那么设这个时间段长为 $t$, 小H抽卡是和 $(t, t)$ 做闵和, 小X抽卡是和 $(-t, 0)$ 做闵和, 同时抽卡是一部分点和 $(t, 0)$, 一部分点和 $(2t, 0)$ 做闵和.

考虑如何维护这个分段函数直接维护显然做不了, 发现这个函数可以分成若干段, 其中每一段中的点是经由相同的转移过来的, 值相同, 而段的端点就可以代表这个走的过程, 设左右端点分别是 $(l, y_1), (r, y_2)$, 这个段内的点 $(x, y)$ 可能是由左边放弃若干X抽卡得到 $(x, y_1)$, 也可能是右边放弃若干H抽卡得到 $(x, y_2-r+x)$, 也就是一个段内的点是它俩取 $max$ 得到, 于是我们只维护关键点的 $y$ 值即可, 则 $-t$ 和 $t, t$ 可以直接平移和全局加, 而第三种操作会让 $[-C, C]$ 内的点路径和两边的不同, 于是要新插入 $C, -C$ 作为关键点, 然后给它们之内的点整体加.

可以写平衡树, 也可以先模拟一遍操作 $1, 2$ 的平移得到关键点实际上应该都插入到哪用线段树.

### D. 卡牌高手

> 背包, 第 $i$ 种物品有 $c_i$ 种体积为 $w_i$, $m$ 次操作单点修改 $c$ 或者询问编号在 $[l, r]$ 中的物品的多重集体积和不超过 $k$ 的有多少种.
> $n, m, w_i\le 5000$, 任意时刻 $\sum_i c_iw_i\le 5000$

显然让你卷区间的 $\dfrac{1-x^{w_i(c_i+1)}}{1-x^{w_i}}$

赛时没注意到任意时刻那部分, 对着加起来的ln不会优化exp.

于是可以直接线段树维护点值, 然后每次询问都乘起来做一次idft, 复杂度是 $8192(n+m\log n+m\log 8192)$

此外, 求点值不如直接把单位根带到封闭形式里.

极度卡常, 不如暴力

## NOI2024省选训练赛6

A, C, D是[之前做过的模拟赛大原题](https://fireinicecode.github.io/2022/10/10/contest-records/#ZSTEST230830)

### B 最大战略储备

原题是 P4809 [CCC2018] 最大战略储备

> 有 $N$ 个星球, 编号为 $1\ldots N$. 每个星球有 $M$ 座城市, 编号为 $1\ldots M$. 我们将 $e$ 星球上的城市 $f$ 记作 $(e, f)$.
> 
> 有 $N\times P$ 条双向航线, 对于每个星球 $e(1\le e\le N)$, 有 $P$ 条航线, 编号为 $1$ 到 $P$. 第 $i$ 条航线连接城市 $(e, \, a_i)$ 和 $(e, \, b_i)$, 且每天需要花费 $c_i$ 的代价维护.
> 
> 有 $M\times Q$ 个双向港口. 对于所有编号为 $f(1\le f\le M)$ 的城市, 有 $Q$ 个港口, 编号为 $1$ 到 $Q$. 第 $j$ 个港口可以连接城市 $(x_j, \, f)$ 和 $(y_j, \, f)$, 且每天需要花费 $z_j$ 的代价维护.
> 
> 现在需要拆除一些港口和(或)取消一些航线, 使得城市之间仍能保持联通, 且节省的代价之和最大.
> 
> 对于全部的数据, $1\le N, \, M, \, P, \, Q\le10^5$.

考虑把 $(e, f)$ 画成一个网格, 则一开始每行连的边相同, 每列连的边相同, 那么可以先分别求出最小生成树.

现在把两个的最小生成树的边合到一起排序从小到大加边, 一次加一排有环的跳过显然就是对的, 一个很显然的结论是若与当前加边方向不同的边加了 $x$ 条, 当前方向本来要加 $n$ 条, 则现在只要加 $n-x$ 条, 就是因为与当前方向不同的每加一次相当于减少一列点, 于是就做完了.

## ICPC模拟赛2

看起来是 2023牛客暑期多校训练营9

### E. Puzzle: Square Jam

> $n \times m$ 网格, 划分成正方形使得没有任何一个点和四个正方形相邻.

简单想想发现每次都取短边长度贴着一边放即可递归下去辗转相减.

坐标输出反了wa了一发/fn

### D. Non-Puzzle: Error Permutation

> 给定长度为 $n$ 的排列, 计算有多少个子区间满足子区间第 $k$ 小的数不在
子区间第 $k$ 位. $n \le 5000$.

考虑枚举左端点和区间内一个点, 要使得这个点不在第 $k$ 位, 考虑其限制右端点不能在一个区间, 这个区间的限制也就是区间内有几个比它小的数, 直接预处理出小于 $i$ 的数的位置 $p_{i, \ldots}$ 和 $i$ 在小于 $j$ 的数中是从前到后第几个 $id_{j, i}$, $n^2$

多测清空没清干净wa了两发/fn

### I. Non-Puzzle: Segment Pair

> 给定 $n$ 对区间 $l_i, r_i, l_i', r_i'$, 每对中选择一个使得所有选择的至少包含一个公共点, 问方案数.
> 
> $n\le 5\times 10^5$

首先最后的交肯定是个区间, 那么考虑直接计算包含某一点有多少种方法, 这个只要算有多少对区间的交/并包含当前点, 但这样会算重, 考虑钦定当前点是最后交的左端点, 这样只要减掉同时包含 $i, i-1$ 的就做完了.

下标偏了一位wa了三发.

### G. Non-Puzzle: Game

> Alice 和 Bob 博弈, Alice先手. 黑板上原有 $n$ 个数 $a_i$, 每次当前行动方可以选择一对 $(i, j)$, 并在黑板上写上 $a_i \operatorname{xor} aj$. 先写下 $k$ 的人胜利. 问博弈结果, 或者平局(无穷局下两人谁也不会写出 $k$).
> 
> $n\le 10^6, a_i\le 2^{30}$

考虑拿到 $k$ 前的那一步显然谁走那一步谁就输, 所以大家会不断开摆进行无效操作(重复之前的某次操作即可), 那么要想不平只有大家都没有之前的步子可重复的清空, 即只要判定Alice能不能第一步直接获胜和有没有Alice不管怎么走Bob第二步直接获胜, 第一个判定显然, 第二个判定就等价于 $a_i\operatorname{xor} a_j=a_p\operatorname{k}\Rightarrow (a_i\operatorname{xor} k) \operatorname{xor}(a_j\operatorname{xor} k)=a_p\operatorname{xor} k$, 于是就是判定 $\{a_i\}$ 在异或 $k$ 下封闭, 只要求线性基然后判断不同元素个数是否是能表示的所有数.

[trick] 利用异或性质写式子.

### F. Non-Puzzle: The Lost Array

> 对于序列 $a_n$, 令 $num_i$ 表示数字 $i$ 出现的次数, 统计满足条件的序列个数:
> - $1 \leq a_i \leq m$
> - 给定一些 $x_i, y_i$, 满足 $a_{x_i} \neq y_i$
> - 给定一些 $x_i, y_i$, 满足 $num_{x_i} \neq y_i$.
> - 将 $num$ 排序后, 得到一给定序列 $B$.
> 
> $n\le 16, m\le 30$

正经人dp肯定是扫值, $f_{i, S, T}$ 表示当前扫了前 $i$ 个数, 能填的位置集合还有 $S$, 剩下还没填的值的出现次数的多重集是 $T$, 注意到 $T$ 很小, 爆搜完了最大 $72$, 复杂度是 $3^nnm72$(转移时要枚举子集).

考虑优化掉集合 $S$ 这一维, 容斥它:

实际上要做的是从 $m$ 个数选出 $n$ 个数组成值集合, 然后到位置集合 $\{1\ldots n\}$ 做双射, 那么现在改成, 设 $f(S)$ 表示值集合和位置集合 $S$ 做双射的方案数(所以 $S$ 为全集时就是答案), $g(S)$ 表示值集合和位置集合任意映射的方案数(一个位置可以填多个值), 那么有 $g(S)=\sum_{T\subseteq S}f(T)$, 于是 $f(S)=\sum_{T\subseteq S}g(T)(-1)^{\vert S\vert-\vert T\vert}$

[trick] 填排列都可以转化成值和位置做映射容斥掉每个位置只能填一次的限制. 同样例题还有ZJOI小星星.

于是复杂度 $2^nnm72$. 很厉害啊这个trick.

## NOI2024省选模拟赛7

### A. 小 W 的滑雪比赛

> 小W要参加滑雪比赛啦！滑雪场有一条主干道，从海拔为 $H$ 的山顶到海拔为 $0$ 的山脚。主干道两边有 $n$ 个检查站，第 $i$ 个距离主干道 $X_i$（为正在右边，为负在左边），海拔为 $Y_i$，如果通过会获得分数 $S_i$。多次经过同一个检查站分数只会计一次，没有两个检查站位置相同。
> 
> 小W想要通过其中一些检查站，最大化自己的得分。为了防止在小G面前出丑，小W基于实地考察评估了每个检查站的容易程度 $E_i$（越大越容易），能够从 $i$ 滑到 $j$ 当且仅当 $\max(\vert X_i - X_j\vert , Y_i - Y_j) \leq E_i$ 且 $Y_i \geq Y_j$，并且从山顶可以到达任何检查站，从任何检查站可以到达山脚。
> 
> 请你帮助小W计算出得分之和的最大值。
>
> $n,H\le 10^5$

不是,为啥kdt的根号过不了1s $2\times 10^5$/fn

总之这是简单dp题,按照$y$排序,设到第$i$个点的代价为$f_i$,可以化成单点改矩形max.

考虑把修改查询均衡一下,那么可以变成每次对纵向线段取max,查询一条横向线段的最大值,这样在$y$从小到大的过程中,纵向建线段树,每个点维护单调栈,标记永久化,复杂度2log.

好强好强,kdt单点加矩形max,查询时大于当前值就不查了,加剪纸跑的飞快.

### B. 数树

> 给定连通图$G(V,E)$,保证不存在从节点$1$开始经过$8$个点的简单路径,求生成树个数,模$2^30$
> 
> $n\le 5\times 10^4,m\le 10^5$

你就不能模的质数吗(

考虑dp,建出以$1$为根的dfs树显然深度不超过$8$,而对于一个点其连边方案只和到根的路径上的点的连通性有关,状压记录这个即可转移,状态数是$m\cdot Bell(7)$,转移的时候需要合并子树内的连通性可能不对?

考虑按照dfs序dp,你仍然只需要记录刚才我们说的内容,但变成了逐个加点,转移就$O(1)$了.

### C. LJJ的农场

> 给定$a_n,b_n$,并$q$次单点改大$a,b$,每次询问后求$\min_{i,j} j\cdot a_i+i\cdot b_j$
> 
> $n,q\le 10^5$

乍一看是二元变量,但实际上固定住一个之后仍然是正常斜率优化,常见的斜率优化是$y=kx+b$最小化$b$,这个相当于$ax+by=c$最小化$c$,那么直接平衡树维护凸壳就做完了,是下凸壳改大,所以要倒着做改小变成向凸壳加点而不是删点.

更简答的直接李超树,然后也是需要倒着走变成每次加线段而不能删.

### D. 黑白点

> 平面上给定 $n$ 个黑点，进行 $m$ 轮操作，每轮加入一个白点。
> 
> 你需要在每次加点操作后求出：最少删去多少黑点和白点使得不存在黑点 $(x,y)$ 和白点 $(x',y')$ 满足 $x\le x',y\le y'$。
>
> $n\le 10^5$

![picture 2](/img/2023-12-15-21-49-38-image.png)  

## NOI2024省选训练赛8

### A. 气球

> 有 $n$ 个气球，一开始都是空的。然后按照从 $1$ 到 $n$ 的顺序依次充气，其中第 $i$ 个气球在充气过程中始终与地面 $x_i$ 位置接触，保证 $x_i$ 单调增。当气球碰到前面的某个气球，或者达到半径最大限制 $r_i$ 时，就会停止充气。请求出每个气球最终半径是多少。
> 
> $n\le 5\times 10^5$

列出式子发现若气球$1,2$接触,则$2\sqrt{r_1}\sqrt{r_2}=x_1-x_2$,斜率优化即可.

### B. mwhak



### C. 数据结构

> 给定一个有 $n$ 个 $01$ 字符串的字符串集合，每个字符串有一个代价。再给定 $01$ 字符串 $T$。你有一个串 $S$，初始为空串，每次你可以从字符串集合内选一个字符串，将其任意长度的前缀或后缀加入到 $S$ 的末尾，代价为该字符串的代价。字符串集合内的字符串可以重复使用。最小化代价总和使得操作完成后 $S = T$，或说明不存在这样的方案。
> 
> $n,m,L\le 2\times 10^5,c_i\le 10^9$

dp设$f_i$表示$i$为结尾的串表示出来的最小代价,看到总长想根号分治,那么长度小于根号的可以直接每次枚举这个长度的,贡献可以用trieac机随便什么算.大于根号的可以直接每个串单独算,那么需要知道每个位置向前向后能在这个串上匹配多远,kmp就能做,做完了之后会转化成区间取min单点查和单点修改区间min,用分块平衡以下即可.

总复杂度单根号.

### D. 礼物