# THUPC

## THUPC2023 Pre

### P9140 [THUPC 2023 初赛] 背包

因为$V$远大于$v_i$和$n$,所以考虑贪心,选出其中性价比最高的元素$i$,则就是要在模$m=v_i$的意义下求恰好为$V$的最大价值,这个几乎是同余最短路,因为此时总代价是$\dfrac{V-v}{m}c_i + res$,其中$res$为选出的元素的$c$之和,所以实际上是最大化$res-\dfrac{v}{m}c_i$,于是同余最短路时先$i\to j+v_i$连$c_i-\dfrac{v_i+j}{m}c_i$的代价即可.

然后同余最短路实际上不用写最短路,它是个模$m$的完全背包问题,加入物品时这个物品的转移形成$gcd(m,v_i)$个环,只要对每个环转移两圈即可保证转移完全.复杂度$nm$

### P9143 [THUPC 2023 初赛] 众数

从大到小排即可.

### P9134 [THUPC 2023 初赛] 拧螺丝

老板肯定每次拿走最大的,小E肯定尽量平均的加,于是反向考虑,最后拿走时是$n$个,那么上一次一定是$n-k,n-k$,往后推下去,则老板每次会让最大值数量增加$1$,然后小E让最大的若干个减少$1$,暴力就是朴素的模拟这个直到最大值变成$0$.于是同一时刻只有最大值和最大值减$1$两个数.

那么考虑把最大值次大值不变的一段压到一起处理,又因为高精所以复杂度$n^2$,然后再特判掉$n=2$时答案是$2^{n-2}$.

### P9133 [THUPC 2023 初赛] 大富翁

支配的代价实际上是有祖先关系的点对代价$1$,那么就是最后局面$\text{敌方点祖先中我方个数}-\text{我方点祖先中敌方个数}$,于是对于每个我方点$u$,答案是$\text{深度}-\text{我方祖先个数}+\text{敌方子孙个数}$,转化贡献,变成每个点给所有子树中的我方点贡献$-1$,就成了$dep_u-siz_u$,于是按照$dep_u-siz_u+w_u$排序贪心选即可.

### P9142 [THUPC 2023 初赛] 欺诈游戏

纳什博弈的结论好像就是最优策略下所有情况期望收益相等.

但是不排除可能双方各自放弃一些决策的情况,不过发现看起来放弃任意一个位置都是不优的.

如果猜到结论,选取任意情况期望都相等,就可以直接列式子解出策略了,当然不能高斯消元,注意到式子形如$x\sum_{i<x} p_i+\sum+{i>x} p_i dfrac{i}{2}$,此时$x+1$减$x$的式子是$\sum_{i<x} p_i+p_x+p_{x+1}\dfrac{x+1}{2}=0$,此时可以递推的把所有$p$用$p_1$表示,最后用$\sum_i p_i=1$就能解出来.

### P9137 [THUPC 2023 初赛] 速战速决

分类讨论,如果你手里有两张相同的则你可以保证对面一张也收不回去(保持牌底的另一张在你手中),否则对面至少收回去一次,并且可以让它最多收回去一次,发现只要第一次放$n$,后面跟着小$J$放即可.

### P9138 [THUPC 2023 初赛] 公平合作

后手策略一定是一直装直到大于先手装的的或者爆了.那么可以设$f_i$表示要求至少装到$i$的情况下不爆的概率(先手选$i$时后手胜的概率),那么先求$g_i$表示装到$i$的概率$g_i=\sum_k g_{i-a_k}\dfrac{1}{n}$,$f_i=1-(\sum_{k<i} g_k\sum_{k+a_l>n} \dfrac{1}{n})$,最后先手再列一个递推式$h_i=\min f_i,(\sum_k \dfrac{1}{n}h_{i+a_k})$.于是获得了一个$nL$的做法.

然后不会了,然后发现这三个都是常系数线性递推,可以做到$n\log n\log L$

### P9144 [THUPC 2023 初赛] 最后的活动

注意到只有$6$层,于是可以直接设$f_i$表示打到当前还剩$i$到$m$的情况下的概率,枚举每一层的策略然后每次转移一整局,如果这一局收益为$x$那么转移到$f_{i-x}$,但是转移可能成环,即$x=0$,于是考虑直接二分,因为$f_i$一定会乘上一个系数所以答案一定比你赋的初值更接近真实值,就做完了.

### P9135 [THUPC 2023 初赛] 快速 LCM 变换

只操作一次,就是删掉两个数再插入一个数.但是lcm的和对每个质因数没有好的独立性,所以只能一起做.

现在只考虑一个因数$d$,删除了数$p,q$,$d$的最大值会变成$\max (smx,p+q)$,那么如果$p+q$有贡献一定意味着$p,q$都是$mx$,此时一定不会让$d$的最终指数减少,也就是说它们的贡献可以独立着看,要么是$p$或$q$带来的减少要么是$p+q$带来的增加,或者说可以写出函数使得$f(x)$为删掉$x$的贡献,$g(x)$为增加$x$的贡献,则答案为$\operatorname{lcm}(\{a_i\})f(x)f(y)g(x+y)$

于是这个就好做了啊,卷卷即可.

### P9139 [THUPC 2023 初赛] 喵了个喵 II 

先考虑如果$2$次怎么做,则若有两种数的出现位置发生包含$a,b,b,a$,则一定无解,因为一定是一个$a,b$一个$b,a$.否则一定有解(一个子序列都放第一次出现的).

然后$4$次,考虑能不能把这$4$个位置$a,b,c,d$先分成两个颜色,则只有$(a,c),(b,d)$和$(a,b),(c,d)$是可能的划分,那么可以写出2sat关系.

但是直接2sat关系爆炸了,注意到实际上每个2sat关系限制是矩形:$(a,c),(b,d)$连向有区间被$(a,c)$或$(b,d)$包含的区间选择另一种方式,而包含是矩形,于是主席树建图优化2sat即可.

### P9136 [THUPC 2023 初赛] 种苹果 

就是加叶子,边上加点,区间加,区间rank,因为这个东西序列上都不能低于根号所以树上你肯定也得根号复杂度.

于是树分块,此时区间加区间rank就维护有序数组和加法标记上去二分,加叶子和边上加点,发现可以直接上去调整,树的形态只维护父亲就行,然后保证复杂度需要根号重构,最后平衡复杂度是$n\sqrt{n\log n}$

## THUPC2022 Pre

### P8213 [THUPC2022 初赛] 挑战

直接倒着dp就行吧

### P8207 [THUPC2022 初赛] 最小公倍树

考虑要么是Kru要么是Brovka,同时这个lcm大概让你考虑gcd.

考虑枚举gcd值$d$,对于$dk,d(k+1)\ldots d(k+p)$,暴力会连$p^2$条边,但后面的都只要和$dk$连就好了,于是总连边数是调和级数过了.

### P8208 [THUPC2022 初赛] 骰子旅行

根据期望线性考虑能不能单独求每个点的期望经过次数,那么暴力dp是计算$f_{u,i,t}$表示现在在$u$,走了$i$次,$t$的期望经过次数,复杂度是$(\sum m)nT$,同理可以出$g_{u,i,t}$表示现在在$u$,走了$i$次曾经过$t$的概率.

###  P8211 [THUPC2022 初赛] 搬砖

注意到如果所有$b\ge 1$则最多只会进行$\sqrt n$次,按照$d$是否$>\sqrt n$讨论即可证明.

于是肯定考虑一次处理一段$d$不变的,而这个只要找到下一个不为$0$的$b$,直接二分就是单log,并查集可以整成线性.

但是不对,因为可能在这过程中因为没有搬完一摞而结束,所以考虑对每个$d<\sqrt n$,按$d$分块,根据一开始的偏移维护$d$个长$\dfrac{n}{d}$的数组,每次插入一个数遍历每个$d$,会修改两个偏移区间的同一个位置的值,于是就是$\sqrt n$次单点修改和查询,总复杂度$n\sqrt n\alpha(n)$

关键大概是$\sqrt n$次以及对小于$\sqrt n$的每个长度和偏移分块是$n\sqrt n$的

### P8212 [THUPC2022 初赛] 喵喵花園

确定一个起始位置就都确定了,那么考虑随着起始位置变化本来每个点位置都在直线上移动,直到有一个点移动到下一条边,于是整个函数是$n$段的.就成了已知每个点坐标为$p_i+v_it$求面积,而面积是相邻两项叉积的和,是二次函数,那么每次暴力算下一个段的起始点并暴力求二次函数看起来是简单的啊.

但是是不是,当你修改一个位置的时候你只是单点改$p$和$v$,于是二次函数修改可以$O(1)$,而每次要找下一个起始点也可以维护,是单点改大,求最小值,看起来可以单log整体.

### P8215 [THUPC2022 初赛] 分组作业 

看到这么离谱的东西应该想流,先给每个人建一个点

然后首先最基本的是愿意,可以用一边的边建成割/不割表示是否愿意,也可以用两边的与源汇连边表示愿意,看起来后者信息更多,这里认为割源点的边表示愿意.

然后对于合作,只要两者各建一条边连 inf 到一个新点,新点向汇点连代价,这样只有这条汇边被保留表示合作.同时再用一条边连到源点,也是二选一表示合作和不合作即可.

然后对于$e$的代价显然只要两个人之间连有向边.

然后喜欢就是刚才的合作建出来的点向另一边表示愿意的点连边即可.

然后你要保证你做的是不能一个人/组把连到源点汇点都割了,因为这么连人和组都至少割一个,所以给这些边每个加$inf$最后减掉即可.

## THUPC 乱做

### P7609 [THUPC2021] 游戏 

让人想起移动金币那个题,考虑逐位做,设$f_{i,S,j,0/1}$表示考虑完低$i$位,当前$S$中的数顶上界,他们的和进位为$j$,总和是否小于等于$n$的方案数.

然后直接做复杂度带$4^m$爆炸,这里按位从低往高不如从高往低,因为那样只要考虑$S$中的数,其他数都不可能变的顶上界,复杂度会变成$3^n$,**因为数位dp从高往低性质其实是比从低往高好在大小限制变化单调**

### P7604 [THUPC2021] 形式语言与自动机 

考虑分成三段后它们的把括号看成$\pm 1$序列后的和以及前缀 $min$的值$s_1,s_2,s_3,m_1,m_2,m_3$,则换完之后显然要满足$m_1\ge 0,s_1+m_3\ge 0,s_1+s_3+m_2\ge 0$.

我们大概率扫描$r$也就是枚举$3$,那么看起来第二个条件转化成$m_2-s_2\ge 0$,也就是后缀 $min=sm_2\ge 0$,这样转化的好处是满足第二个条件的变成了一个区间,显然$m_1\ge 0$也是一个区间,剩下的是$m_3+s_1\ge 0$,其中$m_3$确定,就是求$s_1$的和大于某个值了.总结一下发现这就是下标一维和一维的二维数点,做完了.

### P7605 [THUPC2021] 小 E 爱消除 

容易想到区间dp,那么设$f_{l,r}$为答案后要转移,以左边为例,要么$l$最后也没被消掉可以直接从$f_{l+1,r}$转移,否则假设找到与$l$颜色相同的另一个位置$i$,则一定是拿出$l$,消空$i$左边或右边(可能用到没被消空的一边),比如消没左边,那么枚举用了右边的$k$个,就转移到$f_{i+1,r-k}$,于是需要知道把$j,k$端不可被删除的区间$[i,j],[k,l]$完全消空的最小杯子大小$g_{i,j,k,l}$,而$g$可以用一样的方式转移,最后复杂度$n^6$,然后靠玄学常数过题.

### P7606 [THUPC2021] 混乱邪恶 

好棒的题

就是,本来你肯定直接dp设$f_{i,l,g,x,y}$表示考虑完前$i$个idea,然后$l,g$的值和自己的坐标$x,y$(六边形可以转化成走$x,y$和沿着$y=x$走),然后获得复杂度$n^3p^2$再靠bitset压上$\dfrac{n^3p^2}{w}$

见识新dp优化方案了.一个众所周知的结论是二维平面随机游走期望距离$\sqrt n$,所以可以把输入的idea随机打乱然后把$x,y$只开到$\sqrt n$,使得转移过程中不会出现很大的$x,y$,复杂度就成了$\dfrac{n^2p^2}{w}$

[trick] 随机游走结论更改添加物品顺序以优化dp状态

### P7136 [THUPC2021 初赛] 方格游戏 

注意到最关键的部分:对任意$i,j$,$D_i+1<U_j$ 或 $D_j+1<U_i$ 以及横向的,这个说明不可能用障碍物围迷宫之类的,甚至任意两点只会被一个障碍物影响,因为横竖独立可以光看一边,以纵向绕远为例,因为某个障碍物绕远的条件是起点终点都属于障碍覆盖的纵坐标区间,则会绕一下.

而绕远距离是简单一次函数,求完和二次函数乱算即可.

### P7607 [THUPC2021] 赌徒问题

看起来枚举$s$,然后拿出所有因数暴力背包的复杂度是$m^2d(mk)$,其中$d(mk)$大约是$6000\sim 10000$之间,过不了.

考虑背包的时候$k$的约数先都加进去,每次只插入不是$k$的约数而是$sk$的约数的部分,复杂度就下来了.