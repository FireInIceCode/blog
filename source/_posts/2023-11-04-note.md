---
title: 2023.11
subtitle: 冲!
layout: post
show: true
top: false
tags: 
- 日志
---

### CF1305F Kuroni and the Punishment

> 给定 $n$ 个数. 每次可以选择将一个数 $+1$ 或 $-1$ . 求至少多少次操作使得整个序列都是正数且全部元素的 $\gcd>1$ .
> $n\leq 2\times10^5, 1\le a_i\leq 10^{12}$ .

答案不超过 $n$(全调成偶数).

值域很大, 直接做要求一些 $\sum a_i\bmod g$ 状物, 是困难的, 考虑因为答案不超过 $n$, 那么至少有一半的数被操作至多一次, 于是随一个数, 再随一种操作, 它被这么操作的概率有 $\dfrac{1}{6}$, 随错了的是 $\dfrac{5}{6}$, 那么只要随比如 $50$ 组就行, 然后对着这些可能的操作分解质因数枚举 $gcd$ 即可.

哦, 一直以为cf的possibilities都是概率期望题, 结果是随机化

### CF605E Intergalaxy Trips

> - $n$ 个点的有向完全图.
> - $i \to j$ 的边每天出现的概率均为 $p_{i, j}$, 若 $i = j$, 有 $p_{i, j} = 1$.
> - 每天可以选择一条存在的出边走过去或停留在原地不动.
> - 求最优策略下从 $1$ 到 $n$ 的期望天数.
> - $n \le 10^3$.

首先不考虑转移成环的问题, 你能列出一个式子:

$$
f_u=\min_q \sum_i f_{q_i}(p_{q_i}) \prod_{j<i} {1-p_{q_j}}
$$

然后考虑, $q$ 一定是比你当前更优的点(否则你选择停留而不是走), 于是当前值最小的点就已经确定了, 可以用它更新其它点, 于是复杂度就是 $n^2\log n$ 了.

重点是搞出一个转移顺序.

### CF1093F Vasya and Array

> 给出一段长度为 $n$ 的整数序列, 一个正整数 $k$ , 一个正整数 $len$ , 序列中的所有数均在 $1$ ~ $k$ 之间, 或者等于 $-1$.
> 
> 如果没有长度大于等于 $len$ 的连续相同数字则该数段是好的.
> 
> 可以将 $-1$ 改为所有 $1$ ~ $k$ 之间的整数, 将该数列变为好的, 求出方案数, 对 $998244353$ 取模
> 
> $len, n\le 10^6, k\le 100$

看起来这是个 $nk$ 的复杂度, 那么想设 $f_{i, j}$ 表示 $i$ 的值为 $j$, 发现直接转移这个限制不好做, 联想起HNOI卡农那个题, 枚举一个 $l$, 用总的方案减去最后恰好长 $l$ 的相等段的方案, 那么总的方案直接从 $f_{i-1}$ 转移过来, 而长 $l$ 的第一反应应该是 $\sum_{k\ne j} f_{i-l, k}$, 要求 $k\ne j$ 是因为不然他们在 $i-1$ 处就已经爆了.

### CF1556F Sports Betting

> 有 $n\ (n\le14)$ 个人, 两两之间会打比赛. 每人有一个实力值 $a_i$, 在 $i$ 与 $j$ 的比赛中, $i$ 有 $\frac {a_i}{a_i+a_j}$ 的概率获胜, 其他情况则是 $j$ 获胜. $i$ 在与 $j$ 的比赛中获胜则称 $i$ 打败了 $j$. 若 $i$ 打败了 $j$, $j$ 打败了 $k$, 则认为 $i$ 也打败了 $k$. 若 $i$ 打败了除了他自己以外的所有人, 则称 $i$ 是一个 Winner(是否打败了自己不要求), 注意 Winner  可能有多个. 现在你需要求出 Winner 的期望数量, 对 $1e9+7$ 取模.
> 
> $n\le 14$

容易想到累加每个点成为 Winner 的概率.

那一个点成为Winner相当于给边定向, 要求有一棵以它为根的根向树, 大概会想设 $f_{S, i}$ 表示以 $i$ 为根, $S$ 中的点都有到 $i$ 的路径的概率, 但是一次转移一个点不能处理当前被加进去的点先连到没被加进去的点再连到 $S$ 中点的情况, 所以你要一次转移一层, 设原来层为 $S$, 然后要转移到 $T\supset S$, 那么就要算 $T-S$ 中的点连向 $S$ 中的点的概率, 存在不好表示, 可以考虑转移 $T-S$ 中点都没连到 $S$ 中的概率, 这个就是其中每个点都没连过去的概率乘起来做完了.

另一个想法是, 这是竞赛图, 那么缩点成一条链, 个数就是链上第一个SCC的大小, 对这个dp.

### CF1687D Cute Number

> 定义 $f(x)$ 表示严格大于 $x$ 的最小的完全平方数, 定义 $g(x)$ 为小于等于 $x$ 的最大的完全平方数. 例如, $f(1)=f(2)=g(4)=g(8)=4$.
> 
> 蓝认为, 一个正整数是"可爱”的, 当且仅当 $x-g(x)<f(x)-x$, 例如, $1, 5, 11$ 是可爱的正整数, 而 $3, 8, 15$ 不是.
> 
> 蓝给了你一个长度为 $n$ 的正整数数列 $a_i$, 你需要帮她找到最小的非负整数 $k$, 使得对于 $\forall i$, $a_i+k$ 是可爱的.
>
> $n\le 10^6, a_i\le 2\times 10^6, a_i\ge a_{i-1}$

打个表发现可爱的数出现为若干区间, 第 $i$ 个可爱的区间长度为 $i$, 和上一个间隔 $i-1$.

那么答案最大是 $a_1$ 出现在第 $a_n$ 个区级的首位, 此时一定可行. 那么现在枚举 $a_1$ 所在的区间算 $k$ 可以取到什么值, 由于 $a_1$ 确定的这个区间一定比后面的所在区间短, 于是当使得某个元素走出它原本的区间后不可能再回到同类的区间, 于是这个区间就是让每个数各自是可爱的的区间的交, 且每个区间你只要考虑最前面和最后面的数算上下界, 当你枚举使得 $a_1$ 落在第 $i$ 个区间时, 每段长度都比 $i$ 大, 你最多枚举 $\dfrac{V}{i}$ 段复杂度不超过 $n\ln n$

### CF1254D Tree Queries

> 给定一棵 $N$ 个节点的树, 有 $Q$ 次操作
> 
> $1\space v\space d$ 给定一个点 $v$ 和一个权值 $d$, 等概率地选择一个点 $r$, 对每一个点 $u$, 若 $v$ 在 $u$ 到 $r$ 的路径上, 则 $u$ 的权值加上 $d$ (权值一开始为 $0$)  
> $2\space v$  查询 $v$ 的权值期望, 对 $998244353$ 取模
> $1\leqslant N, Q \leqslant 150000$

容易想到, 对每个点分开看贡献, 则一次对 $v$ 的修改对 $u$ 的贡献是 $n-siz_v$ 或 $n-siz_w$, 其中 $w$ 为子树包含 $u$ 的 $v$ 的儿子.

于是你现在做这个修改是 $O(son\log n)$ 的, 考虑把修改上移一位记录在父亲上, 这样一个点的答案就是 $\sum siz_v w_{fa_v}$, 这种儿子关于父亲的显然只有一条链能维护, 树剖就赢了单log.

我认为点分也可以.

### CF1737E Ela Goes Hiking

> $n$ 只蚂蚁站成一排, 第 $1$ 只蚂蚁左边和第 $n$ 只蚂蚁右边各有一个挡板, 相邻两只蚂蚁的距离、第 $1$ 只蚂蚁与左边挡板的距离和第 $n$ 只蚂蚁与右侧挡板的距离相等. 初始时每只蚂蚁重量相等, 每只蚂蚁有 $\frac{1}{2}$ 概率向左运动, $\frac{1}{2}$ 概率向右运动, 每只蚂蚁速度相同. 中途蚂蚁不可主动改变方向, 如果碰到挡板则向相反方向运动, 若两只蚂蚁相遇, 重量大的蚂蚁会把重量小的蚂蚁吃掉, 重量变为两者之和, 如果重量相同, 向左运动的蚂蚁会吃掉向右运动的蚂蚁. 求对于所有 $i\le1\le n$, 第 $i$ 只蚂蚁成为最终的存活者的概率对 $10^9+7$ 取模.
> 
> $n\le 10^6$

注意速度一样和一开始重量一样. 于是过程是每只向左运动的都会干掉前面连续的向右运动的, 现在还剩下若干向左的, 然后每次前两个决斗剩下一个. 现在要求一个位置 $i$ 成为最后的概率, 要求它要能干掉前面的也就是 $\lfloor \dfrac{i}{2}\rfloor$ 到 $i$ 应该被分成一段, 前面的方案是 $2^{\lfloor i\rfloor}$, 然后它的重量会变成 $i$, 则它干掉后面的概率 $g_i$ 可以枚举它干掉的第一个人 $g_j, j\in [i+1, 2i-1]$, 就能dp了.

### CF1835C Twin Clusters

> 给定 $2^{k+1}$ 个 $[0, 4^k)$ 内的整数, 请求出任意两个不交非空区间使得其异或和相等, 若无解则输出 `-1`.
> 
> $k\le 17$

首先鸽子原理是不是 $2^{k+1}(2^{k+1}-1)/2$ 比 $4^k$ 大将近一倍, 一定有解.

不要鸽子原理了随机你还学过生日悖论, 随一个区间期望 $2^k$ 次相同.

更好的是再砍一半看鸽巢, 你考虑前 $k$ 位有 $2^{k+1}+1$ 种, 那么至少有 $2^k+1$ 个前 $k$ 位相等的对, 又因为后 $k$ 位只有 $2^k$ 种于是又必然出现两个一样的, 于是就做完了.

### CF513G123 Inversions problem

> 有长度 $n$ 的 $n$ 阶排列 $p_i$，$k$ 次操作，每次等概率反转一个区间，求最后逆序对的期望。误差 $<10^{-9}$ 即可。
> 
> $ \textrm{task} 1: n \le6 ,k\le4$。
> 
> $ \textrm{task} 2: n \le30 ,k\le200$。
> 
> $ \textrm{task} 3: n \le100 ,k\le10^9$。

考虑套路,把它转化成对两个数一个数在另一个数前的概率,然后你设$f_{i,j,k}$表示操作$i$次,$j,k$两个数交换了的概率是多少,这个直接枚举翻转区间再搭一个前缀和就是$kn^2$,然后比较离谱的是,显然操作的越多就越接近随一个序列,所以在答案变化量在精度以下时直接停,大概1000轮就行了.